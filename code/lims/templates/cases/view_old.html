{% extends "base.html" %}
{% block content %}
<head>
    <style>
      .table-container {
            display: flex;
        }
        .table-column {
            flex: 1;
            margin: 0 5px;
        }
        .table-bordered th, .table-bordered td {
            border: 1px solid #dddddd !important;
            vertical-align: top;
            padding: 4px;
            font-size: 12px;
        }
        .link {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }
        .custom-container {
            display: flex;
            width: 100%;
            gap: 10px;
        }
        .custom-column {
            flex: 1;
        }
        .custom-table {
            width: 100%;
            border-collapse: collapse;
        }
        .custom-table td, .custom-table th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        .custom-table th {
            background-color: #f2f2f2;
            white-space: nowrap;
        }
        .custom-link {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }
        .btn-link {
            font-size: 24px
            }

        #hide {
            display: none;
        }

        #header {
            position: fixed;
            width: 90%;
        }

        #body{
            overflow: auto;
        }

        mark {
            padding: 0px;
            background-color: #FFFFFF;
        }
        .expanded-content {
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
        }
@media print {
            body * {
                visibility: hidden;
            }
            #all-content, #all-content * {
                visibility: visible;
            }
            #all-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
    <!--  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>-->
    <!--    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>-->
    <!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>-->

    <!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>-->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>-->
</head>
{% if current_user.permissions not in ['Administrative', 'Method Development'] %}
{% set new_item_button %}
<div class="dropdown" style="display:inline-block">
    <div class="dropdown" style="display: inline-block;">
        <button aria-expanded="false" aria-haspopup="true" class="btn btn-secondary dropdown-toggle mb-3"
                data-toggle="dropdown" style="background-color: black; border-color: black;"
                id="results-filter" type="button">Discipline {% if discipline %} | {{ discipline }} {% endif %}
        </button>
        <div class="dropdown-menu" aria-labelledby="cases-filter">
            {% for option in kwargs['disciplines'] %}
            <a href="{{ url_for('cases.view', item_id=item.id, discipline=option)}}" class="dropdown-item">{{ option }}</a>
            {% endfor %}
            <a href="{{ url_for('cases.view', item_id=item.id)}}" class="dropdown-item">All</a>
        </div>
    </div>
    <div class="dropdown" style="display:inline-block">
        <button class="btn btn-success dropdown-toggle mb-3" type="button" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="fa-solid fa-circle-plus"></i> New
        </button>
        <div class="dropdown-menu">
            <a class="dropdown-item" href="{{ url_for('containers.add', case_id=item.id) }}">Container</a>
            {% if containers.all() | length > 0 %}
            <a class="dropdown-item" href="{{ url_for('specimens.add', case_id=item.id) }}">Specimen</a>
            {% endif %}
            {% if specimens.all() | length > 0 %}
            <a class="dropdown-item" href="{{ url_for('tests.add', case_id=item.id) }}">Test</a>
            {% endif %}
            {% if tests.all() | length > 0 %}
            <a class="dropdown-item" href="{{ url_for('results.add', case_id=item.id) }}">Result</a>
            {% endif %}
            {% if results.all() | length > 0 %}
            <a class="dropdown-item" href="{{ url_for('reports.add', item_id=item.id) }}">Report</a>
            <a class="dropdown-item" href="{{ url_for('records.add', item_id=item.id) }}">Record</a>
            <a class="dropdown-item" href="{{ url_for('bookings.add', case_id=item.id) }}">Booking</a>
            <a class="dropdown-item" href="#">Litigation Packet</a>
            {% endif %}
        </div>
        <a class="btn btn-secondary mb-3" href="{{ url_for(table_name~'.attach', item_id=item.id) }}"><i class="fa-solid fa-paperclip"></i> Attach</a>
        <a class="btn btn-secondary mb-3" href="{{ url_for(table_name~'.export_records', item_id=item.id) }}"> Export Case Records</a>
        <a class="btn btn-secondary mb-3" href="/cases/{{item.id}}/litigation_packet_creation">Lit Packet</a>
        {% if current_user.permissions in ['Admin', 'Owner'] %}
        <a class="btn btn-primary mb-3" href="{{url_for(table_name~'.update_retention_policy', item_id=item.id)}}">Update Retention Policy</a>
    </div>
    <form id="filterForm" method="POST" action="/filter_data">
        <input type="hidden" id="selectedDiscipline" name="discipline">
    </form>
    {% endif %}
{% endset %}

    {% if item.locked %}
        <div class="alert alert-warning" role="alert" style="margin-top: 12px">
            <i class="fa-solid fa-lock"></i> This case and its contents have been locked by <b>{{item.locked_by}}</b> on <b>{{item.lock_date.strftime('%m/%d/%Y')}}</b> at <b>{{item.lock_date.strftime('%H:%M')}}</b>.
        </div>
    {% endif %}
    <div style="margin-top:6px">
        <a href="{{url_for('dashboard.get_dashboard')}}"><i class="fa-solid fa-house"></i></a>
        > <a href="{{url_for('cases.view_list')}}">Cases</a>
        > {{item.case_number}}
    </div>
    <div id="all-content">
        <div id="cases-pdf">
            <div id="header">
                <hr style="border-width:5px">
                <h1>
                    {{item.case_number}} |
                    <mark><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" id="last_name" title="{{tooltips['last_name']}}">{{item.last_name}}</a></mark>,
                    <mark><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" id="first_name" title="{{tooltips['first_name']}}">{{item.first_name}}</a></mark>
                    {% if item.middle_name %}
                        <mark><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" id="middle_name" title="{{tooltips['middle_name']}}">{{item.middle_name}}</a></mark>
                    {% endif %}
                |
                <span style="color:#007bff">{{item.case_status}}</span>
            </h1>
            <hr style="border-width:5px">
            <div class="border-bottom">
                {% if item.db_status not in ['Deletion Pending', 'Removed'] %}
                    {% if not view_only %}
                        {% if item.locked and item.locked_by != current_user.initials %}
                            <a class="btn btn-primary mb-3" href="#" ><i class="fa-solid fa-lock"></i> {{item.locked_by}}</a>
                        {% elif item.locked_by == current_user.initials %}
                            {{new_item_button}}
                            {% if pending_containers or pending_specimens %}
                                <div class="btn-group mb-3">
                                    <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#approve-all">Approve All</a>
                                    <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span class="sr-only">Toggle Dropdown</span>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="#" data-toggle="modal" data-target="#approve-select">Approve select items</a>
                                        {% if item.pending_submitter == current_user.initials %}
                                        <a class="dropdown-item" href="{{ url_for(table_name~'.edit', item_id=item.id) }}">Edit Case</a>
                                        {% else %}
                                        <a class="dropdown-item" href="{{ url_for(table_name~'.approve', item_id=item.id) }}">Review Case</a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% elif item.pending_submitter %}
                                {% if item.pending_submitter == current_user.initials %}
                                    <a class="btn btn-primary mb-3" style="display:inline-block" href="{{ url_for('cases.edit', item_id=item.id)}}" role="button">Edit</a>
                                {% else %}
                                    <div class="btn-group mb-3">
                                        <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#approve-all">Approve</a>
                                        <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="sr-only">Toggle Dropdown</span>
                                        </button>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="{{ url_for(table_name~'.approve', item_id=item.id) }}">Review Case</a>
                                        </div>
                                    </div>
                                {% endif %}
                            {% else %}
                                <a class="btn btn-primary mb-3" style="display:inline-block" href="{{ url_for('cases.update', item_id = item.id)}}" role="button">Update</a>
                            {% endif %}
                            {% if specimens_in_custody | count == 0 %}
                                <a class="btn btn-primary mb-3" href="{{url_for(table_name~'.unlock', item_id=item.id)}}" ><i class="fa-solid fa-unlock"></i> Unlock</a>
                            {% else %}
                                <a class="btn btn-primary mb-3" href="#" data-toggle="modal" data-target="#specimen_audit"><i class="fa-solid fa-unlock"></i> Unlock</a>
                            {% endif %}
                        {% else %}
                            {% if item.db_status in ['Active', 'Active with pending changes'] %}
                                <a class="btn btn-primary mb-3" style="display:inline-block" href="{{ url_for('cases.update', item_id = item.id)}}" role="button">Update</a>
                                {{new_item_button}}
                                {% if item.locked != True and current_user.permissions in ['Admin', 'Owner'] %}
                                    <a class="btn btn-danger mb-3" href="{{ url_for(table_name~'.lock', item_id=item.id) }}"><i class="fa-solid fa-lock"></i> Lock</a>
                                {% endif %}
                            {% endif %}
                         {% endif %}
                    {% endif %}
                {% endif %}
            </div>
            <div id="body">
                <div id="case_accordion">
                    <div class="card">
                        <div class="card-header" id="details_heading" style="height:50px; padding:0px; display:flex;align-items:center;">
                            <button class="btn btn-link chevron-btn" id="case_details_btn" data-target="#details" aria-expanded="false" aria-controls="details">
                                Case Details
                            </button>
                        </div>
                        <div class="collapse show" id="details" aria-labelledby="details_heading">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4">
                                        <table class="table-hover table-striped nowrap" style="width: 100%" id="case_details">
                                            <tbody>
                                            <tr class="form-item" name="case_type">
                                                <th>Case Type</th>
                                                <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['case_type_id']}}">{{item.type.name}} ({{item.type.code}})</a></td>
                                            </tr>
                                            <tr>
                                                <th class="form-item" name="case_distinguishers">Case Distinguisher(s)</th>
                                                <td>
                                                    <a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['case_distinguisher']}}">
                                                        {{item.case_distinguisher}}
                                                    </a>
                                                    {% if item.case_distinguisher is not none and item.case_distinguisher != ('None' and '') %}
                                                         |
                                                    {% endif %}
                                                    {% if item.type.code == 'PM' %}
                                                        <a href="" data-target="#update_distinguisher" data-toggle="modal">Update</a>
                                                    {% endif %}
                                                </td>
                                            </tr>

                                            <tr class="form-item" name="priority">
                                                <th>Priority</th>
                                                {% if item.priority == 'High' %}
                                                {% set color = '#FF0000' %}
                                                {% set font_weight = 'bold' %}
                                                {% endif %}
                                                <td style="color:{{color}}; font-weight: {{font_weight}}"><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['priority']}}">{{item.priority}}</a></td>
                                            </tr>
                                            <tr class="form-item" name="sensitivity">
                                                <th>Sensitivity</th>
                                                {% if item.sensitivity == 'High' %}
                                                {% set color = 'red' %}
                                                {% set font_weight = 'bold' %}
                                                {% endif %}
                                                <td style="color:{{color}}; font-weight: {{font_weight}}"><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['sensitivity']}}">{{item.sensitivity}}</a></td>
                                            </tr>
                                            <tr>
                                                <th>Number of Containers</th>
                                                <td>{{item.n_containers}}</td>
                                            </tr>
                                            <tr>
                                                <th>Retention Policy</th>
                                                <td>{{item.retention.name}}</td>
                                            </tr>
                                            <tr>
                                                <th>Discard Eligible <i>(Date)</i></th>
                                                <td>
                                                    {{item.discard_eligible}}

                                                    {% if item.discard_date %}
                                                        (<i>{{item.discard_date.strftime('%m/%d/%Y')}}</i>)
                                                        {% else %}
                                                        (<i>None</i>)
                                                        {% endif %}
                                                    </td>
                                                </tr>

                                                <!--                                    <tr>-->
                                                <!--                                        <th>Discard Date</th>-->
                                                <!--                                        {% if item.discard_date is none %}-->
                                                <!--                                            <td></td>-->
                                                <!--                                        {% else %}-->
                                                <!--                                            <td>{{item.discard_date}}</td>-->
                                                <!--                                        {% endif %}-->
                                                <!--                                    </tr>-->
                                                <!--                                 <tr class="form-item" name="gender">-->
                                                <!--                                        <th>Gender</th>-->
                                                <!--                                        <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['gender']}}">{{item.gender.name}}</a></td>-->
                                                <!--                                    </tr>-->
                                                <!--                                <tr class="form-item" name="birth_sex">-->
                                                <!--                                        <th>Birth Sex</th>-->
                                                <!--                                        <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['birth_sex']}}">{{item.birth_sex}}</a></td>-->
                                                <!--                                    </tr>-->
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col-3">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <!--                                    <tr class="form-item" name="gender">-->
                                                <!--                                        <th>Gender</th>-->
                                                <!--                                        <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['gender']}}">{{item.gender.name}}</a></td>-->
                                                <!--                                    </tr>-->
                                                <!--                                    <tr class="form-item" name="birth_sex">-->
                                                <!--                                        <th>Birth Sex</th>-->
                                                <!--                                        <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['birth_sex']}}">{{item.birth_sex}}</a></td>-->
                                                <!--                                    </tr>-->
                                                <!--                                    <tr>-->
                                                <!--                                        <th>Discard Date</th>-->
                                                <!--                                        {% if item.discard_date is none %}-->
                                                <!--                                            <td></td>-->
                                                <!--                                        {% else %}-->
                                                <!--                                            <td>{{item.discard_date}}</td>-->
                                                <!--                                        {% endif %}-->
                                                <!--                                    </tr>-->
                                                <!--                                                <tr class="form-item" name="gender">-->
                                                <!--                                                    <th>Gender</th>-->
                                                <!--                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['gender_id']}}">{{item.gender.name}}</a></td>-->
                                                <!--                                                </tr>-->
                                                <tr class="form-item" name="birth_sex">
                                                    <th>Gender/Birth Sex</th>
                                                    <td>
                                                        {% if item.gender %}
                                                            <a href="#" class="text-decoration-none t-tip form-item" name="gender" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['birth_sex']}}">{{item.birth_sex}}</a>
                                                        {% endif %}
                                                        {% if item.birth_sex %}
                                                            /
                                                            <a href="#" class="text-decoration-none t-tip form-item" name="birth_sex" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['gender_id']}}">{{item.gender.name}}</a>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr class="form-item" name="race">
                                                    <th>Race</th>
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['race_id']}}">{{item.race.name}}</a></td>
                                                </tr>
                                                <tr>
                                                    <th>Hispanic Ethnicity</th>
                                                    <td>{{item.hispanic_ethnicity}}</td>
                                                </tr>
                                                <tr class="form-item" name="date_of_birth">
                                                    <th>Date of Birth</th>
                                                    {% if item.date_of_birth is none %}
                                                    <td></td>
                                                    {% else %}
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['date_of_birth']}}">{{item.date_of_birth.strftime("%m/%d/%Y")}}</a></td>
                                                    {% endif %}
                                                </tr>
                                                <tr>
                                                    <th>Age</th>
                                                    <td style="color:{{color}}; font-weight: {{font_weight}}"><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['age']}}">{{item.age}}</a></td>
                                                </tr>
                                                <tr>
                                                    <th>Age Status</th>
                                                    <td>{{item.age_status}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Medical Record</th>
                                                    <td>{{item.medical_record}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Marital Status</th>
                                                    <td>{{item.marital_status}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Pregnancy Status</th>
                                                    <td>{{item.pregnancy_status}}</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr class="form-item" name="date_of_incident">
                                                    <th>Date and Time of Incident/Death</th>
                                                    <td>
                                                    {% if item.date_of_incident %}
                                                        <a href="#" class="text-decoration-none t-tip" data-html="true"
                                                           data-toggle="tooltip" data-placement="bottom"
                                                           title="{{tooltips['date_of_incident']}}">
                                                            {{ item.date_of_incident.strftime("%m/%d/%Y") }}
                                                        </a>
                                                        {% if item.time_of_incident %}
                                                            <span> at </span>
                                                            <a href="#" class="text-decoration-none t-tip" data-html="true"
                                                               data-toggle="tooltip" data-placement="bottom"
                                                               title="{{tooltips['time_of_incident']}}">
                                                                {{ item.time_of_incident[:2] }}:{{ item.time_of_incident[2:] }}
                                                            </a>
                                                        {% endif %}
                                                    {% endif %}
                                                    </td>

                                                </tr>

                                                <tr class="form-item" name="submitting_agency">
                                                    <th>Client (Agency)</th>
                                                    <td>
                                                        <a href="{{url_for('agencies.view' , item_id=item.agency.id) }}" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['submitting_agency']}}">
                                                            {{item.agency.name}}
                                                        </a>
                                                    </td>
                                                </tr>
                                                <tr class="form-item" name="submitting_agency">
                                                    <th>Client (Division)</th>
                                                    <td>
                                                        {% if item.division %}
                                                        <a class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['submitting_agency']}}">
                                                            {{item.division.name}}
                                                        </a>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr class="form-item" name="submitter_case_reference_number">
                                                    <th>Case Ref. No.</th>
                                                    <td><a class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['submitter_case_reference_number']}}">{{item.submitter_case_reference_number}}</a></td>
                                                </tr>
                                                <tr class="form-item" name="alternate_case_reference_number_1">
                                                    <th>Alt. Case Ref. No. 1</th>
                                                    <td><a class="text-decoration-none t-tip">{{item.alternate_case_reference_number_1}}</a></td>
                                                </tr>
                                                <tr class="form-item" name="alternate_case_reference_number_2">
                                                    <th>Alt. Case Ref. No. 2</th>
                                                    <td><a class="text-decoration-none t-tip">{{item.alternate_case_reference_number_2}}</a></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width:100%; margin:auto">
                                                <tr class="form-item" name="notes">
                                                    <th>Notes</th>
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['notes']}}">{{item.notes}}</a></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <hr style="border-width:5px">
                                    <div class="row mt-3">
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width:100%; margin:auto">
                                                <thead>
                                                <tr>
                                                    <th></th>
                                                    <th>Requested</th>
                                                    <th>Performed</th>
                                                    <th>Status</th>
                                                    <th>Start Date</th>
                                                    <th>Alternate Start Date</th>
                                                    <th>Dissemination Date</th>
                                                    <th>Days Since Submission (DSS)/Turnaround Time (TAT)</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr class="form-item" name="testing_requested">
                                                    <th style="height: 0.5rem">Toxicology</th>
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['testing_requested']}}">{{item.toxicology_requested}}</a></td>
                                                    <td>{{item.toxicology_performed}}</td>
                                                    <td>{{item.toxicology_status}}</td>
                                                    {% if item.toxicology_start_date is not none %}
                                                    <td>{{item.toxicology_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.toxicology_alternate_start_date is not none %}
                                                    <td>{{item.toxicology_alternate_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.toxicology_end_date is not none %}
                                                    <td>{{item.toxicology_end_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    <td>{{kwargs['toxicology_time']}}</td>
                                                </tr>
                                                <tr class="form-item" name="testing_requested">
                                                    <th>Biochemistry</th>
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['testing_requested']}}">{{item.biochemistry_requested}}</a></td>
                                                    <td>{{item.biochemistry_performed}}</td>
                                                    <td>{{item.biochemistry_status}}</td>
                                                    {% if item.biochemistry_start_date is not none %}
                                                    <td>{{item.biochemistry_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.biochemistry_alternate_start_date is not none %}
                                                    <td>{{item.biochemistry_alternate_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.biochemistry_end_date is not none %}
                                                    <td>{{item.biochemistry_end_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    <td>{{kwargs['biochemistry_time']}}</td>
                                                </tr>
                                                <tr class="form-item" name="testing_requested">
                                                    <th>Histology</th>
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['testing_requested']}}">{{item.histology_requested}}</a></td>
                                                    <td>{{item.histology_performed}}</td>
                                                    <td>{{item.histology_status}}</td>
                                                    {% if item.histology_start_date is not none %}
                                                    <td>{{item.histology_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.histology_alternate_start_date is not none %}
                                                    <td>{{item.histology_alternate_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.histology_end_date is not none %}
                                                    <td>{{item.histology_end_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    <td>{{kwargs['histology_time']}}</td>
                                                </tr>
                                                <tr class="form-item" name="testing_requested">
                                                    <th>External</th>
                                                    <td><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['testing_requested']}}">{{item.external_requested}}</a></td>
                                                    <td>{{item.external_performed}}</td>
                                                    <td>{{item.external_status}}</td>
                                                    {% if item.external_start_date is not none %}
                                                    <td>{{item.external_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.external_alternate_start_date is not none %}
                                                    <td>{{item.external_alternate_start_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    {% if item.external_end_date is not none %}
                                                    <td>{{item.external_end_date.strftime('%m/%d/%Y')}}</td>
                                                    {% else %}
                                                    <td></td>
                                                    {% endif %}
                                                    <td>{{kwargs['external_time']}}</td>
                                                </tr>
                                                <tr class="form-item" name="submitter_requests">
                                                    <th>Submitter Requests</th>
                                                    <td colspan=7 style="text-align:center"><a href="#" class="text-decoration-none t-tip" data-html="true" data-toggle="tooltip" data-placement="bottom" title="{{tooltips['testing_notes']}}">{{item.testing_notes}}</a></td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% if item.type.code == 'PM' %}
                        <div class="card">
                            <div class="card-header" id="fa_heading" style="height:60px; padding:0px; display:flex;align-items:center;">
                                <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#fa_details" aria-expanded="false" aria-controls="fa_details">
                                    <span><i class="fa-solid fa-chevron-right mr-2 chevron"></i></span>
                                    FA Details
                                </button>
                            </div>
                            <div class="collapse show" id="fa_details" aria-labelledby="fa_heading">
                                <div class="card-body">
                                    <h4>Investigative information</h4>
                                    <div class="row">
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>Case Created Date</th>
                                                    <td>
                                                        {% if item.fa_case_entry_date %}
                                                        {{item.fa_case_entry_date.strftime('%m/%d/%Y')}}

                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Case Stage</th>
                                                    <td>{{item.fa_case_stage}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Decedent Case Comments</th>
                                                    <td>{{item.fa_case_comments}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Home Address (County)</th>
                                                    <td>
                                                        <a href="https://google.com/maps/?q={{item.home_address}} {{item.home_zip}}" target="_blank">
                                                            {{item.home_address}} {{item.home_city}} {{item.home_zip}} ({{item.home_county}})
                                                        </a>
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>Investigator</th>
                                                    <td>{{item.primary_investigator}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Restrict Public Access</th>
                                                    <td>{{item.fa_restrict_public_access}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Case Death Type</th>
                                                    <td>{{item.fa_case_death_type}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Death Address (Premise)</th>
                                                    <td>
                                                        {% if item.latitude is not none %}
                                                        <a href="{{url_for('case_map.map', case_id=item.id)}}" target="_blank">
                                                            {{item.death_address}} {{item.death_zip}}
                                                        </a>
                                                        {% else %}
                                                        <a href="https://google.com/maps/?q={{item.death_address}} {{item.death_zip}}" target="_blank">
                                                            {{item.death_address}} {{item.death_zip}}
                                                        </a>
                                                        {% endif %}
                                                        {% if item.death_premises %}
                                                        ({{item.death_premises}})
                                                        {% endif %}
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <hr style="border-width:5px">
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col">
                                            <div class="card">
                                                <div class="card-header view-card-header" id="narratives_heading" style="height:40px; padding:0px; display:flex;align-items:center;">
                                                    <button class="btn btn-link chevron-btn" style="font-size:20px" data-toggle="collapse" data-target="#narratives" aria-expanded="false" aria-controls="narratives">
                                                        <span><i class="fa-solid fa-chevron-right mr-2 chevron"></i></span>
                                                        Narratives
                                                    </button>
                                                </div>
                                                <div class="collapse" id="narratives" aria-labelledby="narratives_heading">
                                                    <div class="card-body">
                                                        <div class="table display">
                                                            <div class="table-responsive">
                                                                <table class="display table-hover table-striped small datatable" style="width:100%" id="narratives_table">
                                                                    <thead>
                                                                    <tr style="text-align:center">
                                                                        <th>Type</th>
                                                                        <th>Narrative</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for item in narratives %}
                                                                    <tr>
                                                                        <td>{{item.narrative_type}}</td>
                                                                        <td>
                                                                            {% if item.narrative | length < 500 %}
                                                                            {{item.narrative | safe}}
                                                                            {% else %}
                                                                            {{item.narrative[:200] | safe}}
                                                                            <span id="dots">... <a href="#" id="show-more">Show More</a></span>
                                                                            <span id="more" hidden>{{item.narrative[200:] | safe}} <a href="#" id="show-less">Show Less</a></span>
                                                                            {% endif %}
                                                                        </td>
                                                                    </tr>
                                                                    {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                    <h4>Autopsy information</h4>
                                    <div class="row">
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>Autopsy Performed</th>
                                                    <td>
                                                        {{item.autopsy_performed}}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Start Date</th>
                                                    <td>
                                                        {% if item.autopsy_start_date %}
                                                        {{item.autopsy_start_date.strftime('%m/%d/%Y')}}
                                                        {% endif %}
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>Autopsy Type</th>
                                                    <td>{{item.autopsy_type}}</td>
                                                </tr>
                                                <tr>
                                                    <th>End Date</th>
                                                    <td>
                                                        {% if item.autopsy_end_date %}
                                                        {{item.autopsy_end_date.strftime('%m/%d/%Y')}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>Exam Status</th>
                                                    <td>{{item.exam_status}}</td>
                                                </tr>
                                                <tr>
                                                    <th>Autopsy Finalized Date</th>
                                                    <td>
                                                        {% if item.autopsy_finalized_date %}
                                                        {{item.autopsy_finalized_date.strftime}}
                                                        {% endif %}
                                                    </td>
                                                </tr>

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <hr>
                                    <h4>Death information</h4>
                                    <div class="row">
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>COD A</th>
                                                    <td>
                                                        {% if item.cod_a %}
                                                        {{item.cod_a}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>COD C</th>
                                                    <td>
                                                        {% if item.cod_c %}
                                                        {{item.cod_c}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Other Conditions</th>
                                                    <td>
                                                        {% if item.other_conditions %}
                                                        {{item.other_conditions}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Manner of Death</th>
                                                    <td>
                                                        {% if item.manner_of_death %}
                                                            {{item.manner_of_death}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Certificate Status</th>
                                                    <td>
                                                        {% if item.certificate_status %}
                                                            {{item.certificate_status}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col">
                                            <table class="table-hover table-striped nowrap" style="width: 100%">
                                                <tbody>
                                                <tr>
                                                    <th>COD B</th>
                                                    <td>
                                                        {% if item.cod_b %}
                                                            {{item.cod_b}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>COD D</th>
                                                    <td>
                                                        {% if item.cod_d %}
                                                            {{item.cod_d}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>How Injury Occurred</th>
                                                    <td>
                                                        {% if item.how_injury_occured %}
                                                            {{item.how_injury_occured}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Method of Death</th>
                                                    <td>
                                                        {% if item.method_of_death %}
                                                            {{item.method_of_death}}
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th>Certified</th>
                                                    <td>
                                                       {% if item.certificate_report_date %}
                                                        {{item.certificate_report_date.strftime('%m/%d/%Y')}} -
                                                       {% endif %}
                                                       {{item.certified_by}}
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <div class="card">
                                <div class="card-header" id="containers_heading" style="height:50px; padding:0px; display:flex;align-items:center;">
                                    <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#containers" aria-expanded="false" aria-controls="containers">
                                        <span><i class="fa-solid fa-chevron-right mr-2 chevron"></i></span>
                                        Containers and Specimens
                                    </button>
                                </div>
                                <div class="collapse show" id="containers" aria-labelledby="containers_heading">
                                    <div class="card-body">
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-hover table-striped small nowrap datatable" id="container_table">
                                                    <thead>
                                                    <tr style="text-align:center">
                                                        <th>Locked</th>
                                                        <th>Pending Submitter</th>
                                                        <th>Custody</th>
                                                        <th>Accession Number</th>
                                                        <th>Type</th>
                                                        <th>Discipline</th>
                                                        <th># Spec. Acc'd/Rec'd</th>
                                                        <th>Container-Specimen</th>
                                                        <th>Submitted By</th>
                                                        <th>Evidence Receipt Comments</th>
                                                        <th>Submission/Collection Date and Time</th>
                                                        <th>Submission Route Type</th>
                                                        <th>Submission Route</th>
                                                        <th>Collection Site</th>
                                                        <th>Collection Container</th>
                                                        <th>Current/Submitted Amount</th>
                                                        <th>Condition</th>
                                                        <th>Notes</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for container in containers %}
                                                    {% set cont_idx =  loop.index %}

                                                    {% if container.db_status in ['Pending', 'Active with pending changes'] %}
                                                    <tr class="table-warning">
                                                        {% elif container.db_status == 'Deletion Pending' %}
                                                    <tr class="table-danger">
                                                        {% elif container.db_status == 'Removed' %}
                                                    <tr class="table-secondary">
                                                        {% else %}
                                                    <tr class="table-default">
                                                        {% endif %}
                                                        <td>
                                                            {% if container.locked %}
                                                            <i class="fa-solid fa-lock"></i> {{container.locked_by}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{container.pending_submitter}}</td>
                                                        <td></td>
                                                        <td>
                                                            {% if container.locked_by == current_user.initials %}
                                                            {% if container.pending_submitter %}
                                                            {% if container.pending_submitter == current_user.initials %}
                                                            <a href="{{url_for('containers.edit', item_id=container.id)}}">
                                                                {{container.accession_number}}
                                                            </a>
                                                            {% else %}
                                                            <a href="{{url_for('containers.approve', item_id=container.id)}}">
                                                                {{container.accession_number}}
                                                            </a>
                                                            {% endif %}
                                                            {% else %}
                                                            <a href="{{url_for('containers.view', item_id=container.id)}}">
                                                                {{container.accession_number}}
                                                            </a>
                                                            {% endif %}
                                                            {% else %}
                                                            <a href="{{url_for('containers.view', item_id=container.id)}}">
                                                                {{container.accession_number}}
                                                            </a>
                                                            {% endif %}
                                                        </td>
                                                        <td>[#{{container.type.code}}#]</td>
                                                        <td></td>
                                                        <td>{{container.n_specimens}}/{{container.n_specimens_submitted}}</td>
                                                        <td>{{cont_idx}}</td>
                                                        <td>{{container.submitter.full_name}}</td>
                                                        <td>{{container.evidence_comments}}</td>
                                                        <td>
                                                            {% if container.submission_date %}
                                                                {{container.submission_date.strftime('%m/%d/%Y')}} {{container.submission_time}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{container.submission_route_type}}</td>
                                                        <td>{{container.submission_route}}</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>{{container.notes}}</td>
                                                    </tr>
                                                    {% set spec_idx = namespace(value = 0) %}
                                                    {% for specimen in specimens %}
                                                    {% if specimen.container_id == container.id %}
                                                    {% set spec_idx.value = spec_idx.value + 1 %}
                                                    {% if specimen.db_status in ['Pending', 'Active with pending changes'] %}
                                                    <tr class="table-warning">
                                                        {% elif specimen.db_status == 'Deletion Pending' %}
                                                    <tr class="table-danger">
                                                        {% elif specimen.db_status == 'Removed' %}
                                                    <tr class="table-secondary">
                                                        {% else %}
                                                    <tr class="table-default">
                                                        {% endif %}
                                                        <td>
                                                            {% if specimen.locked %}
                                                            <i class="fa-solid fa-lock"></i> {{specimen.locked_by}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{specimen.pending_submitter}}</td>
                                                        <td>{{specimen.custody}}</td>
                                                        <td>
                                                            {% if specimen.locked_by == current_user.initials %}
                                                                {% if specimen.pending_submitter %}
                                                                {% if specimen.pending_submitter == current_user.initials and specimen.custody != current_user.initials %}
                                                                <a class="edit-specimen" style="margin-left: 20px" href="#" data-toggle="modal" name="{{specimen.accession_number}}" value="{{specimen.id}}" data-target="#edit-specimen">
                                                                    {{specimen.accession_number}}
                                                                </a>
                                                                {% elif specimen.pending_submitter == current_user.initials and specimen.custody == current_user.initials %}
                                                                <a href="{{url_for('specimens.edit', item_id=specimen.id)}}" style="margin-left: 20px">
                                                                    {{specimen.accession_number}}
                                                                </a>
                                                                {% else %}
                                                                <a href="{{url_for('specimens.approve', item_id=specimen.id)}}" style="margin-left: 20px">
                                                                    {{specimen.accession_number}}
                                                                </a>
                                                                {% endif %}
                                                                {% else %}
                                                                <a href="{{url_for('specimens.view', item_id=specimen.id)}}" style="margin-left: 20px">
                                                                    {{specimen.accession_number}}
                                                                </a>
                                                                {% endif %}
                                                            {% else %}
                                                                <a href="{{url_for('specimens.view', item_id=specimen.id)}}" style="margin-left: 20px">
                                                                    {{specimen.accession_number}}
                                                                </a>
                                                            {% endif %}
                                                        </td>
                                                        <td>[{{specimen.type.code}}]</td>
                                                        <td>{{specimen.type.discipline}}</td>
                                                        <td></td>
                                                        <td>{{cont_idx}}-{{spec_idx.value}}</td>
                                                        <td></td>
                                                        <td>{{specimen.evidence_comments}}</td>
                                                        <td>
                                                            {% if specimen.collection_date is not none %}
                                                            {{specimen.collection_date.strftime('%m/%d/%Y')}}
                                                            {{specimen.collection_time}}
                                                            {% endif %}
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>{{specimen.specimen_site.name}}</td>
                                                        <td>{{specimen.collection_container.name}}</td>
                                                        <td>
                                                            {{specimen.current_sample_amount}}/{{specimen.submitted_sample_amount}}
                                                            {{specimen.type.unit.name}}
                                                        </td>
                                                        <td>{{specimen.condition}}</td>
                                                        <td>{{specimen.notes}}</td>
                                                    </tr>
                                                    {% endif %}
                                                    {% endfor %}
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% if current_user.permissions in ['Admin', 'Owner', 'FLD'] %}
                            <div class="card">
                                <div class="card-header" id="tests_heading" style="height:50px; padding:0px; display:flex;align-items:center;">
                                    <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#tests" aria-expanded="true" aria-controls="tests">
                                        <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: '#FF0000'"></i></span>
                                        Tests
                                    </button>
                                </div>
                                <div class="collapse show" id="tests" aria-labelledby="tests_heading">
                                    <div class="card-body">
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display small display nowrap" style="width:100%" id="test_table">
                                                    <thead id="main">
                                                    <tr>
                                                        <th></th>
                                                        <th>Assay</th>
                                                        <th>Discipline</th>
                                                        <th>Batch</th>
                                                        <th>Batch Date</th>
                                                        <th>Test</th>
                                                        <th>Test Status</th>
                                                        <th>Specimen Accession Number</th>
                                                        <th>Specimen Type</th>
                                                        <th>Dilution</th>
                                                        <th>Comments</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% if tests.all() | length > 0%}
                                                    {% for test in tests %}
                                                    {% if loop.cycle('odd', 'even') == 'even' %}
                                                    {% set color = 'white' %}
                                                    {% else %}
                                                    {% set color = '#F9F9F9' %}
                                                    {% endif %}
                                                    <tr class="main" style="background-color: {{color}}">
                                                        <td class="row-control">
                                                            {% if test.id in test_ids  %}
                                                                <a href="#!"><i class="fa-solid fa-square-plus expand"></i></a>
                                                            {% endif %}
                                                        </td>
                                                        <td>{{test.assay.assay_name}}</td>
                                                        <td>{{test.assay.discipline}}</td>
                                                        <td>
                                                            {% if test.batch %}
                                                                <a href="{{url_for('batches.view', item_id=test.batch.id)}}">
                                                                    {{test.batch.batch_id}}
                                                                </a>
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                             {% if test.batch %}
                                                                {% if test.batch.extraction_date%}
                                                                    {{test.batch.extraction_date.strftime('%m/%d/%Y')}}
                                                                {% endif %}
                                                            {% endif %}

                                                        </td>
                                                        <td>{{test.test_name}}</td>
                                                        <td>{{test.test_status}}</td>
                                                        <td>{{test.specimen.accession_number}}</td>
                                                        <td>
                                                            {% if test.specimen %}
                                                                [{{test.specimen.type.code}}]
                                                            {% endif %}
                                                        </td>
                                                        <td>{{test.dilution}}</td>
                                                        <td>
                                                            {% if test.id in test_comment_dict.keys() %}
                                                                <a href="#!" data-toggle="tooltip" title="{{test_comment_dict[test.id]}}">View comments</a>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr class="hidden_row" id="hide" aria-expanded="false">
                                                        <td colspan="11" id="hidden_row">
                                                            <table class="display table-hover table-striped nowrap hide ml-5" style="left-margin: 50px;" id="result">
                                                                <thead>
                                                                <tr>
                                                                    <th>Result Status</th>
                                                                    <th>Result Type</th>
                                                                    <th>Component Name</th>
                                                                    <th>Result</th>
                                                                    <th>Supp. Result</th>
                                                                    <th>Qualitative</th>
                                                                    <th>Comments</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody>
                                                                {% if test.id in test_ids %}
                                                                {% for result in results %}
                                                                {% if result.test_id == test.id and result.result_status == 'Confirmed' %}
                                                                {% if result.scope %}
                                                                {% set unit = result.scope.unit.name %}
                                                                {% endif %}
                                                                <tr>
                                                                    <td>{{result.result_status}}</td>
                                                                    <td>{{result.result_type}}</td>
                                                                    <td>
                                                                        {% if result.component %}
                                                                        <a href="{{url_for('components.view', item_id=result.component_id) }}">
                                                                            {{result.component.name}}
                                                                        </a>
                                                                        {% else %}
                                                                            {{result.component_name}}
                                                                        {% endif %}
                                                                    </td>
                                                                    <td align="right">
                                                                        {{result.result}}
                                                                        {% if result.result_type != 'Not Detected' %}
                                                                        {{unit}}
                                                                        {% endif %}
                                                                    </td>
                                                                    <td align="right">
                                                                        {% if result.supplementary_result %}
                                                                            {{result.supplementary_result}}
                                                                            {% if result.supplementary_result %}
                                                                                {{unit}}
                                                                            {% endif %}
                                                                        {% endif %}
                                                                    </td>
                                                                    <td>{{result.qualitative_reason}}</td>
                                                                    <td>
                                                                        {% if result.id in result_comment_dict.keys() %}
                                                                            <a href="#!" data-toggle="tooltip" title="{{result_comment_dict[result.id]}}">View comments</a>
                                                                        {% endif %}
                                                                    </td>
                                                                </tr>
                                                                {% endif %}
                                                                {% endfor %}
                                                                {% else %}
                                                                <tr>
                                                                    <td colspan="4" style="text-align: center">
                                                                        <b>No Result Found</b><br>
                                                                        If historical data, check test comments
                                                                    </td>
                                                                </tr>
                                                                {% endif %}
                                                                </tbody>
                                                            </table>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                    {% else %}
                                                    <td colspan="11" style="text-align: center; background-color:#F9F9F9">No Tests Added</td>
                                                    {% endif %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="results_heading">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#results" aria-expanded="false" aria-controls="results">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: '#FF0000'"></i></span>
                                            Results
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse show" id="results" aria-labelledby="results_heading">
                                    <div class="card-body">
                                        <div class="alert alert-warning" id="confirmed-only-alert">Showing only <b>confirmed</b> results. Click the <b>Clear</b> button to show all results.</div>
                                        <a class="btn btn-primary mb-2" id="clear-filter">Clear</a>
                                        <a class="btn btn-primary mb-2" id="filter-confirmed">Confirmed</a>
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-hover table-striped small nowrap datatable" style="width:100%" id="results_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Assay</th>
                                                        <th>Discipline</th>
                                                        <th>Batch</th>
                                                        <th>Batch Date</th>
                                                        <th>Accession Number</th>
                                                        <th>Specimen</th>
                                                        <th>Result Type</th>
                                                        <th>Result Status</th>
                                                        <th>Component Name</th>
                                                        <th>Result</th>
                                                        <th>Supplementary Result</th>
                                                        <th>Qualitative</th>
                                                        <th>Outlier Reason</th>
                                                        <th>Comments</th>
                                                        <th>Test</th>
                                                        <th>Notes</th>
                                                        <th>Reported</th>
                                                        <th>Primary</th>

                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for item in results %}
                                                    {% if item.scope %}
                                                    {% set unit = item.scope.unit.name %}
                                                    {% endif %}
                                                    <tr>
                                                        <td>{{item.test.assay.assay_name}}</td>
                                                        <td>{{ item.test.assay.discipline }}</td>
                                                        <td>
                                                            <a href="{{url_for('batches.view', item_id=item.test.batch.id)}}">
                                                                {{item.test.batch.batch_id}}
                                                            </a>
                                                        </td>
                                                        <td>
                                                            {% if item.test.batch %}
                                                                {{item.test.batch.extraction_date.strftime('%m/%d/%Y')}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{item.test.specimen.accession_number}}</td>
                                                        <td>[{{item.test.specimen.type.code}}]</td>
                                                        <td id="result-status">{{item.result_status}}</td>
                                                        <td>{{item.result_type}}</td>
                                                        <td>
                                                            {% if item.component %}
                                                                <a href="{{url_for('components.view', item_id=item.component_id) }}">
                                                                    {{item.component.name}}
                                                                </a>
                                                            {% else %}
                                                                {{item.component_name}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {{item.result}}
                                                            {% if item.result_type != 'Not Detected' %}
                                                            {{unit}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if item.supplementary_result %}
                                                                {{item.supplementary_result}}
                                                                {% if item.supplementary_result %}
                                                                    {{unit}}
                                                                {% endif %}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{item.qualitative_reason}}</td>
                                                        <td>{{item.outlier_reason}}</td>
                                                        <td>
                                                            {% if item.id in result_comment_dict.keys() %}
                                                                <a href="#!" data-toggle="tooltip" title="{{result_comment_dict[item.id]}}">View comments</a>
                                                            {% endif %}
                                                        </td>
                                                        <td>{{item.test.test_name}}</td>
                                                        <td>{{item.notes}}</td>
                                                        <td>{{item.reported}}</td>
                                                        <td>{{item.primary}}</td>
                                                    </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                {% if item.type.code == "Q" %}
                                <div class="card-header" id="pt_eval_heading">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#pt_evals" aria-expanded="false" aria-controls="pt_eval">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                            PT Evaluations
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse" id="pt_evals" aria-labelledby="pt_eval_heading">
                                    <div class="card-body">
                                        {% for item in pt_evals %}
                                        <a href="{{url_for('pt_results.view_eval',item_id=item.result_official)}}">{{item.eval_date.strftime('%m/%d/%Y')}}</a><br>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            <div class="card">
                                <div class="card-header" id="report_heading">
                                    <h5 class="mb-0">
                                        <button aria-controls="reports" aria-expanded="true" class="btn btn-link chevron-btn"
                                                data-target="#reports" data-toggle="collapse">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                            Reports
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse show" id="reports" aria-labelledby="reports_heading">
                                    <div class="card-body">
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-hover table-striped small display nowrap datatable" style="width:100%" id="report_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Delete?</th>
                                                        <th>Report Name</th>
                                                        <th>Report Name</th>
                                                        <th>Case Number</th>
                                                        <th>Discipline</th>
                                                        <th>Report Number</th>
                                                        <th>Draft Number</th>
                                                        <th>Draft Status</th>
                                                        <th>CR</th>
                                                        <th>CR Date</th>
                                                        <th>DR</th>
                                                        <th>DR Date</th>
                                                        <th>PDF</th>
                                                        <th>Record</th>
                                                        <th>Date Created</th>
                                                        <th>Created By</th>
                                                        <th>Date Modified</th>
                                                        <th>Modified By</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for item in reports %}
                                                    <tr>
                                                        <td align="center"><a href="{{url_for(table_name~'.delete', item_id=item.id)}}" class="btn btn-danger btn-size"><i class="fa fa-trash-o btn-icon"></i></a></td>
                                                        <td>
                                                            <a href="{{url_for(table_name~'.view', item_id=item.id)}}">
                                                                {{item.report_name}}
                                                            </a>
                                                        </td>
                                                        <td>{{item.report_name}}</td>
                                                        <td>
                                                            <a href="{{url_for('cases.view', item_id=item.case.id)}}">
                                                                {{item.case.case_number}}
                                                            </a>
                                                        </td>
                                                        <td>{{item.discipline}}</td>
                                                        <td>{{item.report_number}}</td>
                                                        <td>{{item.draft_number}}</td>
                                                        <td>{{item.draft_status}}</td>
                                                        <td>
                                                            {% if item.case_reviewer %}
                                                            {{item.case_reviewer.initials}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if item.case_review_date %}
                                                            {{item.case_review_date.strftime('%m/%d/%Y')}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if item.divisional_reviewer %}
                                                            {{item.divisional_reviewer.initials}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if item.divisional_reviewer_date %}
                                                            {{item.divisional_review_date.strftime('%m/%d/%Y')}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            <a href="../static/filesystem/reports/{{item.report_name}}.pdf">PDF</a>
                                                        </td>
                                                        <td>
                                                            {% if item.record %}
                                                            {{item.record.record_name}}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if item.create_date %}
                                                            {{item.create_date.strftime('%m/%d/%Y %H:%M')}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{item.created_by}}</td>
                                                        <td>
                                                            {% if item.modify_date %}
                                                            {{item.modify_date.strftime('%m/%d/%Y %H:%M')}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{item.modified_by}}</td>
                                                    </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="records_heading">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#records" aria-expanded="true" aria-controls="records">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                            Records
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse show" id="records" aria-labelledby="records_heading">
                                    <div class="card-body">
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-hover table-striped small display nowrap datatable" style="width:100%" id="record_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Record Name</th>
                                                        <th>Record Status</th>
                                                        <th>Record Type</th>
                                                        <th>Record Number</th>
                                                        <th>Dissemination Date</th>
                                                        <th>Disseminated By</th>
                                                        <th>Disseminated To</th>
                                                        <th>View PDF</th>
                                                        <th>Comments</th>
                                                        <th>Date Created</th>
                                                        <th>Created By</th>
                                                        <th>Date Modified</th>
                                                        <th>Modified By</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for item in records %}
                                                    <tr>
                                                        <td>{{item.record_name}}</td>
                                                        <td>{{item.record_status}}</td>
                                                        <td>{{item.record_type}}</td>
                                                        <td>{{item.record_number}}</td>
                                                        <td>
                                                            {% if item.dissemination_date %}
                                                            {{item.dissemination_date.strftime('%m/%d/%Y')}}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{item.disseminated_by}}</td>
                                                        <td>{{item.disseminated_to}}</td>
                                                        {% if item.record_name in kwargs['pdfs'] %}
                                                        <td>
                                                            <a href="../static/filesystem/records/{{item.case.case_number}}/{{item.record_name}}.pdf" target="_blank">View Record</a>
                                                        </td>
                                                        {% else %}
                                                        <td></td>
                                                        {% endif %}
                                                        <td>{{item.general_comments}}</td>

                                                        {% if item.create_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{item.create_date.strftime('%Y-%m-%d %H:%M:%S')}}</td>
                                                        {% endif %}

                                                        <td>{{item.created_by}}</td>

                                                        {% if item.modify_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{item.modify_date.strftime('%Y-%m-%d %H:%M:%S')}}</td>
                                                        {% endif %}
                                                        {% if item.modified_by == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{item.modified_by}}</td>
                                                        {% endif %}
                                                    </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="bookings_heading">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#bookings" aria-expanded="true" aria-controls="bookings">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                            Bookings
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse show" id="bookings" aria-labelledby="bookings_heading">
                                    <div class="card-body">
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-striped table-hover small nowrap datatable" style="width:100%" id="bookings_table">
                                                    <thead>
                                                    <tr>
                                                        <th>View</th>
                                                        <th>Status</th>
                                                        <th>Case</th>
                                                        <th>Subject</th>
                                                        <th>Expert</th>
                                                        <th>Date</th>
                                                        <th>Purpose</th>
                                                        <th>Agency Met With/Subpoena'd By</th>
                                                        <th>Name Met With/Subpoena'd</th>
                                                        <th>Change (e.g., cancelled, rescheduled, no-show)</th>
                                                        <th>Format</th>
                                                        <th>Location</th>
                                                        <th>Others Present</th>
                                                        <th>Crossed-By, if Court</th>
                                                        <th>Start</th>
                                                        <th>Finish</th>
                                                        <th>Drive Time</th>
                                                        <th>Excluded Time (e.g., lunch)</th>
                                                        <th>Waiting Time</th>
                                                        <th>Total Testifying Time</th>
                                                        <th>Total Work Time</th>
                                                        <th>Information Provided</th>
                                                        <th>Topics Discussed</th>
                                                        <th>Notes</th>
                                                        <th>Legacy Transferred</th>
                                                        <th>Date Created</th>
                                                        <th>Created By</th>
                                                        <th>Date Modified</th>
                                                        <th>Modified By</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for booking in bookings %}
                                                    <tr>
                                                        <td>
                                                            <a href="{{url_for('bookings.view', item_id=booking.id)}}">
                                                                View
                                                            </a>
                                                        </td>
                                                        <td>{{booking.db_status}}</td>
                                                        <td>{{booking.case.case_number}}</td>
                                                        <td>{{booking.case.last_name}}, {{booking.case.first_name}} {{booking.case.middle_name}}</td>
                                                        <td>{{booking.expert.initials}}</td>
                                                        <td>{{booking.date.strftime('%A, %B %d, %Y')}}</td>
                                                        <td>{{booking.purpose}}</td>
                                                        <td>{{booking.agency_id}}</td>
                                                        <td>{{booking.personnel_id}}</td>
                                                        <td>{{booking.change}}</td>
                                                        <td>{{booking.meeting_format}}</td>
                                                        <td>{{booking.location}}</td>
                                                        <td>{{booking.others_present}}</td>
                                                        <td>{{booking.cross_examined}}</td>
                                                        <td>{{booking.start}}</td>
                                                        <td>{{booking.finish}}</td>
                                                        <td>{{booking.drive_time}}</td>
                                                        <td>{{booking.excluded_time}}</td>
                                                        <td>{{booking.waiting_time}}</td>
                                                        <td>{{booking.total_testifying_time}}</td>
                                                        <td>{{booking.total_work_time}}</td>
                                                        <td>
                                                            {% if booking.information_provider %}
                                                            {% for info in booking.information_provider.split(', ') %}
                                                            {{kwargs['booking_info_provider'].query.get(info|int).name}};
                                                            {% endfor %}
                                                            {% endif %}
                                                        </td>
                                                        <td>
                                                            {% if booking.topics_discussed %}
                                                            {% for info in booking.topics_discussed.split(', ') %}
                                                            <ul>{{kwargs['booking_info_provided'].query.get(info|int).name}}</ul>
                                                            {% endfor %}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{booking.notes}}</td>
                                                        <td>{{booking.legacy_transferred}}</td>
                                                        {% if booking.create_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{booking.create_date.strftime('%m/%d/%Y %H:%M')}}</td>
                                                        {% endif %}
                                                        <td>{{booking.created_by}}</td>

                                                        {% if booking.modify_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{booking.modify_date.strftime('%m/%d/%Y %H:%M')}}</td>
                                                        {% endif %}
                                                        <td>{{booking.modified_by}}</td>
                                                    </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" id="litigation_packets_heading">
                            <h5 class="mb-0">
                                <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#litigation_packets" aria-expanded="true" aria-controls="litigation_packets">
                                    <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                    Packets
                                </button>
                            </h5>
                        </div>
                        <div class="collapse show" id="litigation_packets" aria-labelledby="litigation_packets_heading">
                            <div class="card-body">
                                <div class="table display">
                                    <div class="table-responsive">
                                        <table class="display table-hover table-striped small display nowrap" style="width:100%" id="litigation_packets_table">
                                            <thead>
                                            <tr>
                                                <th>Packet Name</th>
                                                <th>Created By</th>
                                                <th>Packet Status</th>
                                                <th>Packet Preparer</th>
                                                <th>Packet Reviewer</th>
                                                <th>Requested Date</th>
                                                <th>Requesting Agency</th>
                                                <th>Requesting Division</th>
                                                <th>Requesting Personnel</th>
                                                <th>Due Date</th>
                                                <th>Delivery Date</th>
                                                <th>Number of Pages</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for packet in packets %}
                                            <tr>
                                                <td><a href="{{url_for('litigation_packets.view', item_id=packet.id)}}">{{packet.packet_name}}</a></td>
                                                <td>{{packet.created_by}}</td>
                                                <td>{{packet.packet_status}}</td>
                                                <td>{{packet.prep_user.initials}} {% if packet.litigation_prepare_date
                                                    is not none
                                                    %}{{packet.litigation_prepare_date.strftime('%m/%d/%Y')}}{% endif %}
                                                </td>
                                                <td>{{packet.rev_user.initials}} {% if packet.litigation_review_date is
                                                    not none %}{{packet.litigation_review_date.strftime('%m/%d/%Y')}} {%
                                                    endif %}
                                                </td>
                                                <td>{{packet.requested_date.strftime('%m/%d/%Y')}}</td>
                                                <td>{{packet.agency.name}}</td>
                                                <td>{{packet.division.name}}</td>
                                                <td>{{packet.personnel.full_name}}</td>
                                                <td>{% if packet.due_date is not none %}{{packet.due_date.strftime('%m/%d/%Y')}}{% endif %}</td>
                                                <td>{{packet.delivery_date}}</td>
                                                <td>{{packet.n_pages}}</td>
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!--                    <div class="card">-->
                            <!--                        <div class="card-header" id="ttee_heading">-->
                            <!--                            <h5 class="mb-0">-->
                            <!--                                <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#ttee" aria-expanded="false" aria-controls="ttee">-->
                            <!--                                    <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>-->
                            <!--                                    TTEE-->
                            <!--                                </button>-->
                            <!--                            </h5>-->
                            <!--                        </div>-->
                            <!--                        <div class="collapse" id="ttee" aria-labelledby="ttee_heading">-->
                            <!--                            <div class="card-body">-->
                            <!--                                <div class="table display">-->
                            <!--                                    <div class="table-responsive">-->
                            <!--                                        <table class="display table-hover table-striped small display nowrap" style="width:100%" id="ttee_table">-->
                            <!--                                            <thead>-->
                            <!--                                            <tr>-->

                            <!--                                            </tr>-->
                            <!--                                            </thead>-->
                            <!--                                            <tbody>-->
                            <!--                                            <tr>-->

                            <!--                                            </tr>-->
                            <!--                                            </tbody>-->
                            <!--                                        </table>-->
                            <!--                                    </div>-->
                            <!--                                </div>-->
                            <!--                            </div>-->
                            <!--                        </div>-->
                            <!--                    </div>-->
                            <div class="card">
                                <div class="card-header" id="attachments_heading">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#attachments" aria-expanded="true" aria-controls="attachments">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                            Attachments
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse show" id="attachments" aria-labelledby="attachments_heading">
                                    <div class="card-body">
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-hover table-striped small display nowrap" style="width:100%" id="attachments_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Delete</th>
                                                        <th>File Name</th>
                                                        <th>Type</th>
                                                        <th>Source</th>
                                                        <th>Description</th>
                                                        <th>Added By</th>
                                                        <th>Add Date</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for attachment in attachments%}
                                                    <tr>
                                                        <td><a href="{{url_for('attachments.delete', item_id=attachment.id)}}" class="btn btn-danger btn-size"><i class="fa fa-trash-o btn-icon" style="font-size:10px"></i></a></td>
                                                        <td>
                                                            {% if attachment.name.split('.')[1] in ['pdf', 'jpg', 'png'] %}
                                                            <a href="../static/{{attachment.name}}" target="_blank">{{attachment.name}}</a>
                                                            {% else %}
                                                            <a href="../static/{{attachment.name}}" download>{{attachment.name}}</a>
                                                            {% endif %}
                                                        </td>
                                                        <td>{{attachment.type.name}}</td>
                                                        <td>{{attachment.type.source}}</td>
                                                        <td>{{attachment.description}}</td>
                                                        <td>{{attachment.created_by}}</td>
                                                        {% if attachment.create_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{attachment.create_date.strftime('%m/%d/%Y %H:%M')}}</td>
                                                        {% endif %}
                                                    </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header" id="audit_heading">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link chevron-btn" data-toggle="collapse" data-target="#audit" aria-expanded="false" aria-controls="audit">
                                            <span><i class="fa-solid fa-chevron-right mr-2 chevron" style="border: #FF0000"></i></span>
                                            Audit
                                        </button>
                                    </h5>
                                </div>
                                <div class="collapse" id="audit" aria-labelledby="audit_heading">
                                    <div class="card-body">
                                        <div class="my-3 row">
                                            <div class="col">
                                                <table class="table-hover table-striped nowrap col" style="width: 100%">
                                                    <tr class="col">
                                                        <th>Created By</th>
                                                        <td>{{item.created_by}}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div class="col">
                                                <table class="table-hover table-striped nowrap col" style="width: 100%">
                                                    <tr class="col">
                                                        <th>Create Date</th>
                                                        <td>
                                                            {% if item.create_date %}
                                                            {{item.create_date.strftime('%m/%d/%Y %H:%M')}}
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div class="col">
                                                <table class="table-hover table-striped nowrap col" style="width: 100%">
                                                    <tr class="col">
                                                        <th>Modified By</th>
                                                        <td>{{item.modified_by}}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div class="col">
                                                <table class="table-hover table-striped nowrap col" style="width: 100%">
                                                    <tr class="col">
                                                        <th>Modify Date</th>
                                                        <td>
                                                            {% if item.modify_date %}
                                                            {{item.modify_date.strftime('%m/%d/%Y %H:%M')}}
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="table display">
                                            <div class="table-responsive">
                                                <table class="display table-hover table-striped small nowrap" id="audit_table">
                                                    <thead>
                                                    <tr>
                                                        <th>Event</th>
                                                        <th>Status</th>
                                                        <th>Revision</th>
                                                        <th>Field</th>
                                                        <th>Original Value</th>
                                                        <th>New Value</th>
                                                        <th>Submitter</th>
                                                        <th>Submit Date</th>
                                                        <th>Reviewer</th>
                                                        <th>Review Date</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for mod in mods %}
                                                    <tr>
                                                        <td>{{mod.event}}</td>
                                                        <td>{{mod.status}}</td>
                                                        <td>{{mod.revision}}</td>
                                                        <td>{{mod.field}}</td>
                                                        <td>{{mod.original_value_text}}</td>
                                                        <td>{{mod.new_value_text}}</td>
                                                        <td>{{mod.submitter.initials}}</td>

                                                        {% if mod.submitted_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{mod.submitted_date.strftime('%Y-%m-%d %H:%M:%S')}}</td>
                                                        {% endif %}

                                                        <td>{{mod.reviewer.initials}}</td>

                                                        {% if mod.review_date == None %}
                                                        <td></td>
                                                        {% else %}
                                                        <td>{{mod.review_date.strftime('%Y-%m-%d %H:%M:%S')}}</td>
                                                        {% endif %}
                                                    </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Approve case and all evidence modal -->
    <div class="modal" tabindex="-1" role="dialog" id="approve-all">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm approval</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>By clicking on "Confirm", you <b>({{current_user.initials}})</b> confirm that the details for the following are correct:</p>
                    {% if not case_approved %}
                    <b>Case</b>
                    <li>{{item.case_number}}</li>
                    {% endif %}
                    {% if pending_containers %}
                    <b>Containers</b>
                    {% for container in pending_containers %}
                    {% if container.pending_submitter %}
                    <li>{{container.accession_number}} | {{container.type.name}}</li>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% if pending_specimens %}
                    <b><li class="list-unstyled">Specimens</li></b>
                    {% for specimen in pending_specimens %}
                    {% if specimen.pending_submitter %}
                    <li>{{specimen.accession_number}} | {{specimen.type.name}}</li>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                </div>
                <form class="form" action="{{ url_for(table_name~'.approve_all', item_id=item.id) }}" method="POST" enctype="multipart/form-data">
                    <div class="modal-body">
                        {% if specimens_in_custody %}
                        <p>The following specimen(s) are in your possession. Please select their next location.</p>
                        <!--          <div class="row" style="margin-bottom:10px">-->
                        <!--                      <div class="col-md-1" style="align-content:center">-->
                        <!--                        <label name="label" style="margin-bottom: 0px">All</label>-->
                        <!--                      </div>-->
                        <!--                      <div class="col-md-5">-->
                        <!--                        <select class="form-control selectpicker custody-type" name="custody-type">-->
                        <!--                            <option value="0">Please select a custody type</option>-->
                        <!--                            <option value="Bench">Bench</option>-->
                        <!--                            <option value="Cabinet">Cabinet</option>-->
                        <!--                            <option value="Fume Hood">Fume Hood</option>-->
                        <!--                            <option value="Person">Person</option>-->
                        <!--                            <option value="Refrigerator or Freezer">Refrigerator or Freezer</option>-->
                        <!--                        </select>-->
                        <!--                      </div>-->
                        <!--                      <div class="col-md-5">-->
                        <!--                        <select class="form-control selectpicker custody" name="custody">-->
                        <!--                            <option value="0">No custody type selected</option>-->
                        <!--                        </select>-->
                        <!--                        <div class="invalid-feedback custody-invalid"></div>-->
                        <!--                      </div>-->
                        <!--                  </div>-->
                        <!--                  <hr>-->
                        {% for specimen in specimens_in_custody %}
                        <div class="row specimen-row" style="margin-bottom:10px">
                            <div class="col-md-1" style="align-content:center">
                                <label name="label" style="margin-bottom: 0px">{{specimen.accession_number}}</label>
                                <input name="specimen-id" value="{{specimen.id}}" hidden>
                            </div>
                            <div class="col-md-5">
                                <select class="form-control selectpicker custody-type" name="custody-type" required>
                                    <option value="0">Please select a custody type</option>
                                    <option value="Bench">Bench</option>
                                    <option value="Cabinet">Cabinet</option>
                                    <option value="Hood">Hood</option>
                                    <option value="Person">Person</option>
                                    <option value="Cooled Storage">Cooled Storage</option>
                                    <option value="Storage">Storage</option>
                                </select>
                            </div>
                            <div class="col-md-5 hello">
                                <select class="form-control selectpicker custody" name="custody" required>
                                    <option value="0">No custody type selected</option>
                                </select>
                                <div class="invalid-feedback custody-invalid"></div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
<!--                    <form class="form" action="{{ url_for(table_name~'.approve_all', item_id=item.id) }}" method="POST" enctype="multipart/form-data">-->
<!--                        <div class="modal-body">-->
<!--                            {% if specimens_in_custody %}-->
<!--                            <p>The following specimen(s) are in your possession. Please select their next location.</p>-->
<!--                            &lt;!&ndash;          <div class="row" style="margin-bottom:10px">&ndash;&gt;-->
<!--                            &lt;!&ndash;                      <div class="col-md-1" style="align-content:center">&ndash;&gt;-->
<!--                            &lt;!&ndash;                        <label name="label" style="margin-bottom: 0px">All</label>&ndash;&gt;-->
<!--                            &lt;!&ndash;                      </div>&ndash;&gt;-->
<!--                            &lt;!&ndash;                      <div class="col-md-5">&ndash;&gt;-->
<!--                            &lt;!&ndash;                        <select class="form-control selectpicker custody-type" name="custody-type">&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="0">Please select a custody type</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="Bench">Bench</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="Cabinet">Cabinet</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="Fume Hood">Fume Hood</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="Person">Person</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="Refrigerator or Freezer">Refrigerator or Freezer</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                        </select>&ndash;&gt;-->
<!--                            &lt;!&ndash;                      </div>&ndash;&gt;-->
<!--                            &lt;!&ndash;                      <div class="col-md-5">&ndash;&gt;-->
<!--                            &lt;!&ndash;                        <select class="form-control selectpicker custody" name="custody">&ndash;&gt;-->
<!--                            &lt;!&ndash;                            <option value="0">No custody type selected</option>&ndash;&gt;-->
<!--                            &lt;!&ndash;                        </select>&ndash;&gt;-->
<!--                            &lt;!&ndash;                        <div class="invalid-feedback custody-invalid"></div>&ndash;&gt;-->
<!--                            &lt;!&ndash;                      </div>&ndash;&gt;-->
<!--                            &lt;!&ndash;                  </div>&ndash;&gt;-->
<!--                            &lt;!&ndash;                  <hr>&ndash;&gt;-->
<!--                            {% for specimen in specimens_in_custody %}-->
<!--                            <div class="row specimen-row" style="margin-bottom:10px">-->
<!--                                <div class="col-md-1" style="align-content:center">-->
<!--                                    <label name="label" style="margin-bottom: 0px">{{specimen.accession_number}}</label>-->
<!--                                    <input name="specimen-id" value="{{specimen.id}}" hidden>-->
<!--                                </div>-->
<!--                                <div class="col-md-5">-->
<!--                                    <select class="form-control selectpicker custody-type" name="custody-type" required>-->
<!--                                        <option value="0">Please select a custody type</option>-->
<!--                                        <option value="Bench">Bench</option>-->
<!--                                        <option value="Cabinet">Cabinet</option>-->
<!--                                        <option value="Hood">Hood</option>-->
<!--                                        <option value="Person">Person</option>-->
<!--                                        <option value="Cooled Storage">Cooled Storage</option>-->
<!--                                        <option value="Evidence Lockers">Evidence Lockers</option>-->
<!--                                    </select>-->
<!--                                </div>-->
<!--                                <div class="col-md-5 hello">-->
<!--                                    <select class="form-control selectpicker custody" name="custody" required>-->
<!--                                        <option value="0">No custody type selected</option>-->
<!--                                    </select>-->
<!--                                    <div class="invalid-feedback custody-invalid"></div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            {% endfor %}-->
<!--                            {% endif %}-->
<!--                        </div>-->
                        <div class="modal-footer">
                            <button class="btn btn-primary" type="submit">Confirm</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


<!-- Approve case and selected evidence modal -->
<!-- Approve case and selected evidence modal -->
<div class="modal" tabindex="-1" role="dialog" id="approve-select">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Please select the items you wish to approve.</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form class="form" id="approve-select-form" name="form" action="{{ url_for(table_name~'.approve_selected', item_id=item.id) }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    {% if not case_approved %}
                    <div class="form-group">
                        <b><label>Do you wish to approve the case details for {{item.case_number}}?</label></b><span style="color: red">*</span>
                        <select class="form-control selectpicker" id="approve-case" name="approve-case">
                            <option value="0">Please select an answer</option>
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                        <div class="invalid-feedback" id="approve-case-invalid"></div>
                    </div>
                    {% endif %}
                    {% if pending_containers %}
                    <div class="form-group">
                        <b><label>Containers</label></b>
                        <select class="form-control selectpicker" name="approved-containers" id="container-select" multiple>
                            {% for container in pending_containers %}
                            {% if container.pending_submitter %}
                            <option value="{{container.id}}">{{container.accession_number}} | {{container.type.name}}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    {% if pending_specimens %}
                    <div class="form-group">
                        <b><label>Specimens</label></b>
                        <select class="form-control selectpicker" name="approved-specimens" id="specimen-select" multiple>
                            {% for specimen in pending_specimens %}
                            {% if specimen.pending_submitter %}
                            <option value="{{specimen.id}}">{{specimen.accession_number}} | {{specimen.type.name}}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    {% if specimens_in_custody | count %}
                    <p>The following specimen(s) are in your possession. Please select their next location.</p>
                    <!--                 <div class="row" style="margin-bottom:10px">-->
                    <!--                      <div class="col-md-1" style="align-content:center">-->
                    <!--                        <label name="label" style="margin-bottom: 0px">All</label>-->
                    <!--                      </div>-->
                    <!--                      <div class="col-md-5">-->
                    <!--                        <select class="form-control selectpicker custody-type" name="custody-type">-->
                    <!--                            <option value="0">Please select a custody type</option>-->
                    <!--                            <option value="Bench">Bench</option>-->
                    <!--                            <option value="Cabinet">Cabinet</option>-->
                    <!--                            <option value="Fume Hood">Fume Hood</option>-->
                    <!--                            <option value="Person">Person</option>-->
                    <!--                            <option value="Refrigerator or Freezer">Refrigerator or Freezer</option>-->
                    <!--                        </select>-->
                    <!--                      </div>-->
                    <!--                      <div class="col-md-5">-->
                    <!--                        <select class="form-control selectpicker custody" name="custody">-->
                    <!--                            <option value="0">No custody type selected</option>-->
                    <!--                        </select>-->
                    <!--                        <div class="invalid-feedback custody-invalid"></div>-->
                    <!--                      </div>-->
                    <!--                  </div>-->
                    <!--                  <hr>-->
                    {% for specimen in pending_specimens %}
                    <div class="row specimen-row" style="margin-bottom:10px" id="{{specimen.id}}">
                        <div class="col-md-1" style="align-content:center">
                            <label name="label" style="margin-bottom: 0px">{{specimen.accession_number}}</label>
                            <input name="specimen-id" value="{{specimen.id}}" hidden>
                        </div>
                        <div class="col-md-5">
                            <select class="form-control selectpicker custody-type" name="custody-type" disabled>
                                <option value="0">Please select a custody type</option>
                                <option value="Bench">Bench</option>
                                <option value="Cabinet">Cabinet</option>
                                <option value="Hood">Hood</option>
                                <option value="Person">Person</option>
                                <option value="Cooled Storage">Cooled Storage</option>
                                <option value="Evidence Lockers">Evidence Lockers</option>
                            </select>
                        </div>
                        <div class="col-md-5">
                            <select class="form-control selectpicker custody" name="custody" disabled>
                                <option value="0">No custody type selected</option>
                            </select>
                            <div class="invalid-feedback custody-invalid"></div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit">Approve</button>
                    <button type="button" class="btn btn-secondary" onclick="clearModal()">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>
        <!-- Set location for specimen in user possession -->
        <!--Need to make sure to add specimen audit to cases\views.py-->
<div class="modal" tabindex="-1" role="dialog" id="specimen_audit">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Specimen in your possession</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form class="form" action="{{ url_for(table_name~'.unlock', item_id=item.id) }}" name="form" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <p>The following specimen(s) are in your possession. Please select their next location.</p>
                    <!--          <div class="row" style="margin-bottom:10px">-->
                    <!--              <div class="col-md-1" style="align-content:center">-->
                    <!--                <label name="label" style="margin-bottom: 0px">All</label>-->
                    <!--              </div>-->
                    <!--              <div class="col-md-5">-->
                    <!--                <select class="form-control selectpicker" name="custody-type" id="custody-type-all">-->
                    <!--                    <option value="0">Please select a custody type</option>-->
                    <!--                    <option value="Bench">Bench</option>-->
                    <!--                    <option value="Cabinet">Cabinet</option>-->
                    <!--                    <option value="Fume Hood">Fume Hood</option>-->
                    <!--                    <option value="Person">Person</option>-->
                    <!--                    <option value="Refrigerator or Freezer">Refrigerator or Freezer</option>-->
                    <!--                </select>-->
                    <!--              </div>-->
                    <!--              <div class="col-md-5">-->
                    <!--                <select class="form-control selectpicker" name="custody" id="custody-type-all">-->
                    <!--                    <option value="0">No custody type selected</option>-->
                    <!--                </select>-->
                    <!--                <div class="invalid-feedback custody-invalid"></div>-->
                    <!--              </div>-->
                    <!--          </div>-->
                    <!--          <hr>-->
                    {% for specimen in specimens_in_custody %}
                    <div class="row specimen-row" style="margin-bottom:10px">
                        <div class="col-md-1" style="align-content:center">
                            <label name="label" style="margin-bottom: 0px">{{specimen.accession_number}}</label>
                            <input name="specimen-id" value="{{specimen.id}}" hidden>
                        </div>
                        <div class="col-md-5">
                            <select class="form-control selectpicker custody-type" id="custody-type" name="custody-type">
                                <option value="0">Please select a custody type</option>
                                <option value="Bench">Bench</option>
                                <option value="Cabinet">Cabinet</option>
                                <option value="Hood">Hood</option>
                                <option value="Person">Person</option>
                                <option value="Cooled Storage">Cooled Storage</option>
                                <option value="Evidence Lockers">Evidence Lockers</option>
                            </select>
                        </div>
                        <div class="col-md-5 hello">
                            <select class="form-control selectpicker custody" id="custody" name="custody">
                                <option value="0">No custody type selected</option>
                            </select>
                            <div class="invalid-feedback custody-invalid"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit">Submit</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!--<div class="modal" tabindex="-1" id="edit-specimen" data-backdrop="static">-->
<!--    <div class="modal-dialog modal-lg modal-dialog-centered">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h5 class="modal-title">Edit Specimen</h5>-->
<!--                <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                    <span aria-hidden="true">&times;</span>-->
<!--                </button>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <p style="text-align:center;">-->
<!--                    By proceeding, you will take custody of <b><span class="accession_number"></span></b>.-->
<!--                    You will need to select the next custody location when submitting the form.-->
<!--                </p>-->
<!--                <p style="text-align:center;">Do you wish to proceed?</p>-->

<!--            </div>-->
<!--            &lt;!&ndash;buttons go below&ndash;&gt;-->
<!--            <div class="modal-footer" style="justify-content:center;">-->
<!--                <a class="btn btn-primary mr-3" style="width: 12rem" href="#" id="proceed">Go to Edit Form</a>-->
<!--                <a class="btn btn-secondary ml-3" style="width: 10rem" href="#" id="view-only">View Only</a>-->
<!--                <a class="btn btn-secondary ml-3" style="width: 12rem" data-dismiss="modal">Cancel</a>-->
<!--            </div>-->
<!--        </div>-->

<!--        UPDATE CASE DISTINGUISHER MODAL-->
        <div class="modal" tabindex="-1" id="update_distinguisher" data-backdrop="static">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Update Case Distinguisher</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <form class="form" method="POST" enctype="multipart/form-data" novalidate="novalidate">
                        {{form.hidden_tag()}}
                        <div class="modal-body">
                                <div class="row" style="justify-content: center">
                                    {{form.case_distinguisher.label(style='font-weight: bold')}}
                                </div>
                                <div class="row" style="justify-content: center">
                                    {{form.case_distinguisher(class='selectpicker')}}
                                </div>
                        </div>
                        <!--buttons go below-->
                        <div class="modal-footer" style="justify-content:center;">
                            {{form.submit(class='btn btn-primary')}}
                            <a class="btn btn-secondary" data-dismiss="modal">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>



<script>
        $(document).ready(function() {
            $('#review').on('click', function() {
                $('#case_review').css('display','none');
            });
        });
</script>


<script type="text/javascript">
    $(document).ready(function() {
        $('.expand').on('click', function(){
            var isExpanded = $(this).parents().next('.row_control').attr("aria-expanded")
            $(this).parents().next('.hidden_row').toggle();
            //alert();

        });
    });
</script>

<script>
    $("#case_accordion").on("hide.bs.collapse show.bs.collapse", e => {
  $(e.target)
    .prev()
    .find("i:last-child");
});
</script>

<script>
    $('.collapse').on('shown.bs.collapse', function () {
       $($.fn.dataTable.tables(true)).DataTable()
          .columns.adjust();
    });
</script>

<script>

$(document).ready(function () {

    //initDataTable($('#container_table'), 100)
    //var results_table = $('#results_table').DataTable()
    //var results_table = initDataTable($('#results_table'), 100)
    //initDataTable($('#report_table'), 100)
    //var record_table = initDataTable($('#record_table'), 100)
    //var bookings_table = initDataTable($('#bookings_table'), 100)
    //initDataTable($('#audit_table'), 100)
});
</script>
<script>
   $(document).ready( function () {
        $('#container_table').DataTable({
            pageLength: -1,
            scrollX: true,
            scrollY: '50vh',
            scrollCollapse: true,
            lengthMenu: [[10, 50, 100, -1], [10, 50, 100, 'All']],
            order: [],
        });
    });
</script>
<script>
   $(document).ready( function () {
        $('#results_table').DataTable({
            pageLength: -1,
            scrollX: true,
            scrollY: '50vh',
            scrollCollapse: true,
            lengthMenu: [[10, 50, 100, -1], [10, 50, 100, 'All']],
            order: [],
        });
    });
</script>
<script>
    $('#clear-filter').on('click', function() {
         var table = $('#results_table').DataTable()
         table.columns().search("").draw()
         $('#confirmed-only-alert').attr('hidden', true)
    })
</script>
<script>

    function ShowConfirmed() {
        var table = $('#results_table').DataTable()
        var colIdx = table.column($('#result-status')).index()
        table.column(colIdx).search('^Confirmed$', true, false).draw()
        $('#confirmed-only-alert').attr('hidden', false)
    }

    $(document).ready(ShowConfirmed)
    $('#filter-confirmed').on('click', ShowConfirmed)

</script>
<script>
   $(document).ready( function () {
        $('#report_table').DataTable({
            pageLength: -1,
            scrollX: true,
            scrollY: '50vh',
            scrollCollapse: true,
            lengthMenu: [[10, 50, 100, -1], [10, 50, 100, 'All']],
            order: [],
        });
    });
</script>
<script>
   $(document).ready( function () {
        $('#record_table').DataTable({
            pageLength: -1,
            scrollX: true,
            scrollY: '50vh',
            scrollCollapse: true,
            lengthMenu: [[10, 50, 100, -1], [10, 50, 100, 'All']],
            order: [],
        });
    });
</script>
<script>
   $(document).ready( function () {
        $('#audit_table').DataTable({
            pageLength: -1,
            scrollX: true,
            scrollY: '50vh',
            scrollCollapse: true,
            lengthMenu: [[10, 50, 100, -1], [10, 50, 100, 'All']],
            order: [],
        });
    });
</script>
<script>
   $(document).ready( function () {
        $('#bookings_table').DataTable({
            pageLength: -1,
            scrollX: true,
            scrollY: '50vh',
            scrollCollapse: true,
            lengthMenu: [[10, 50, 100, -1], [10, 50, 100, 'All']],
            order: [],
        });
    });
</script>

<script>

    $(document).ready(function () {
    // Setup - add a text input to each footer cell

    $('#attachments_table thead tr')
        .clone(true)
        .addClass('attachments_filters')
        .appendTo('#attachments_table thead');

    var attachments_table = $('#attachments_table').DataTable({
        dom: 'lrtip',
        scrollX: true,
        scrollY: "40vh",
        scrollCollapse: true,
        orderCellsTop: true,
        order: [],
        pageLength: 25,
        initComplete: function () {
            var attachments_api = this.api();

            // For each column
           attachments_api
                .columns()
                .eq(0)
                .each(function (colIdx) {
                    // Set the header cell to contain the input element
                    var attachments_cell = $('.attachments_filters th').eq(
                        $(attachments_api.column(colIdx).header()).index()
                    );
                    var attachments_title = $(attachments_cell).text();
                    $(attachments_cell).html('<input type="text" placeholder="' + attachments_title + '" style="border: 1px solid lightgray; border-radius: 5px;  "/>');

                    // On every keypress in this input
                    $(
                        'input',
                        $('.attachments_filters th').eq($(attachments_api.column(colIdx).header()).index())
                    )
                        .off('keyup change')
                        .on('change', function (e) {
                            // Get the search value
                            $(this).attr('attachments_title', $(this).val());
                            var attachments_regexr = '({search})'; //$(this).parents('th').find('select').val();

                            var cursorPosition = this.selectionStart;
                            // Search the column for that value
                            attachments_api
                                .column(colIdx)
                                .search(
                                    this.value != ''
                                        ? attachments_regexr.replace('{search}', '(((' + this.value + ')))')
                                        : '',
                                    this.value != '',
                                    this.value == ''
                                )
                                .draw();
                        })
                        .on('keyup', function (e) {
                            e.stopPropagation();

                            $(this).trigger('change');
                            $(this)
                                .focus()[0]
                                .setSelectionRange(cursorPosition, cursorPosition);
                        });
                });

        },
    });
});

</script>


<script>
    $(document).ready(function () {
  $('#tests_table').DataTable();
});
</script>


<script>
    $('.expand').on('click', function () {
        if ($(this).attr('class').includes('fa-square-plus')){
            $(this).removeClass('fa-square-plus');
            $(this).addClass('fa-square-minus');
        } else {
            $(this).removeClass('fa-square-minus');
            $(this).addClass('fa-square-plus');
        }
    });
</script>

<script>
    $(document).ready(function () {
        array = '{{pending_fields | safe}}'
        $('mark').each(function () {
            var id = $(this).find('a').attr('id')
            if (array.includes(id)) {
                $(this).css('background-color', '#FFEEBA')
            }
        });
        $('.form-item').each(function () {
           name = $(this).attr('name')
           if (array.includes(name)) {
            $(this).addClass('table-warning');
           }
        });
    });
</script>

<script>
    $(function(){
  	$('#review').click(function() {
  	    $(this).data('clicked', true);
        let view = 'review';
      	alert(view);
      });
});
</script>

<script>
$('.accession-number').on('click', function (){
    var accession_number = $(this).attr('name')
    var specimen_id = $(this).attr('value')
    $('#accession-number').html(accession_number);
    $('#edit').attr('href', "../specimens/"+specimen_id+"?view_only=False")
    $('#review').attr('href', "../specimens/"+specimen_id+"?view_only=False")
    $('#view-only').attr('href', "../specimens/"+specimen_id+"?view_only=True")
});
</script>


<script type="text/javascript">

$('.custody-type').on('change', function() {
   let custody_type = $(this).val();
   //let custody = $(this).parent().siblings('.custody').children('.custody');
   let custody = $(this).parents('.col-md-5').siblings('.col-md-5').children('.custody').children('.custody');
   console.log(custody);
   $.getJSON('/specimens/get_custody_locations/', {
        custody_type: custody_type,
        }, function(data) {
            var HTML = '';
            for (var choice of data.choices) {
                HTML += '<option value="' + choice.id + '">' + choice.name + '</option>';
            }
            console.log(HTML);
            custody.prop('innerHTML', HTML);
            custody.prop('innterHTML');
            custody.selectpicker('val', " ");
            custody.selectpicker('refresh');
            custody.selectpicker('render');
     });
     return false;
});

</script>
<script>
  $('.form').on('submit', function(event) {
    let errors = 0;
    $(this).find('select.custody').each(function () {
        let custody = $(this).val()
        if (!$(this).siblings('button').hasClass('disabled')) {
            if (custody == 0) {
                errors += 1
                $(this).parent().addClass("is-invalid");
                $(this).parent().siblings('.invalid-feedback').html('No location selected');
            } else {
              $(this).parent().removeClass("is-invalid");

            }
        }
    });

    if (errors != 0) {
      event.preventDefault();
    }
  });
</script>

<script>
    $('#specimen-select').on('change', function () {
        specimen_ids = $(this).val();
        $('.specimen-row').each( function () {
            specimen_id = $(this).attr('id');
            if (specimen_ids.includes(specimen_id)) {
                $(this).find('div.form-control').each( function () {
                    $(this).children('select').attr('disabled', false);
                    $(this).children('button').removeClass('disabled');
                });
            } else {
                $(this).find('div.form-control').each( function () {
                    $(this).children('button').addClass('disabled');
                });
            }
        });
    });
</script>

<script>
    $('#approve-select-form').on('submit', function () {
        let approve_case = $('#approve-case').val()
        if (approve_case == 0) {
          $('#approve-case').parent().addClass('is-invalid');
          $('#approve-case-invalid').html("Please select an answer.")
          event.preventDefault();
        }
    });

</script>

<script>
    function clearModal() {
        $('#approve-select').modal('hide');
    }
</script>

<script>
    $('.edit-specimen').on('click', function (){
        var accession_number = $(this).attr('name')
        var id = $(this).attr('value')
        $('.accession_number').html(accession_number);
        $('#proceed').attr('href', "/specimens/"+id+"/edit")
        $('#view-only').attr('href', "/specimens/"+id+"?view_only=True")
    });
</script>

<script>
    $('#container-select, #specimen-select').selectpicker({
                    "liveSearch": true,
                    "selectedTextFormat": "count > 10",
                    "actionsBox": true,
                    })

</script>

<script>
    $('#custody-type-all').on('change', function () {
        let custody_type = $(this).val();
        //let custody = $(this).parents('.col-md-5').siblings('.col-md-5').children('.custody').children('.custody');
        let custody = $('#custody-all');
        $('#specimen_audit .specimen-row').each( function () {
            console.log($(this).children('.col-md-5').children('.custody-type').children('.custody-type').attr('class'))
        });
         $.getJSON('/specimens/get_custody_locations/', {
            custody_type: custody_type,
            }, function(data) {
                var HTML = '';
                for (var choice of data.choices) {
                    HTML += '<option value="' + choice.id + '">' + choice.name + '</option>';
                }
                custody.prop('innerHTML', HTML);
                custody.selectpicker('val', " ");
                custody.selectpicker('refresh');
                custody.selectpicker('render');
         });
         return false;
     });
</script>
<!--<script>-->
<!-- document.getElementById('print-all-content').addEventListener('click', function() {-->
<!--        console.log("Button clicked");-->

<!--        // Get the content to print-->
<!--        var content = document.getElementById('pdf-test');-->

<!--        // Check if the element is found-->
<!--        if (!content) {-->
<!--            console.error("Element with id 'pdf-test' not found");-->
<!--            return;-->
<!--        }-->

<!--        // Temporarily show the hidden element-->
<!--        content.style.display = "block";-->
<!--        content.style.padding-->
<!--        console.log("Content made visible");-->

<!--        // Use html2pdf to generate the PDF-->
<!--        var opt = {-->
<!--            margin:       0.5,-->
<!--            filename:     'myfile.pdf',-->
<!--            image:        { type: 'jpeg', quality: 0.98 },-->
<!--            html2canvas:  { scale: 2, useCORS: true },-->
<!--            jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }-->
<!--        };-->

<!--        html2pdf().from(content).set(opt).toPdf().get('pdf').then(function (pdf) {-->
<!--            console.log("PDF generated");-->
<!--            var pdfBlob = pdf.output('blob');-->
<!--            var blobUrl = URL.createObjectURL(pdfBlob);-->
<!--            window.open(blobUrl);-->

<!--            // Revert the display property-->
<!--            content.style.display = "none";-->
<!--            console.log("Content hidden again");-->
<!--        }).catch(function(error) {-->
<!--            console.error('Error generating PDF:', error);-->

<!--            // Ensure the display property is reverted in case of error-->
<!--            content.style.display = "none";-->
<!--        });-->
<!--    });-->
<!--    </script>-->

<script>
        $(document).ready(function() {
        const itemId = "{{ item.id }}"
            $('#lit-packet-generation').click(function() {
                $.ajax({
                    url: `/cases/${itemId}/litigation_packet_print`,
                    method: 'GET',
                    success: function(response) {
                        alert('Litigation Packet Generated')
                        // Show a message when PDF is generated
                    },
                    error: function(xhr, status, error) {
                        console.error("An error occurred:", error);
                    }
                });
                alert('Litigation Packet Generated')
            });
        });
</script>
<!--batches-pdf-generation-->
<script>
        $(document).ready(function() {
        const itemId = "{{ item.id }}"
            $('#batches-pdf-generation').click(function() {
                $.ajax({
                    url: `/cases/${itemId}/batches_pdf_print`,
                    method: 'GET',
                    success: function(response) {
                        alert('Batches PDF Generated')
                        // Show a message when PDF is generated
                    },
                    error: function(xhr, status, error) {
                        console.error("An error occurred:", error);
                    }
                });
                alert('Batches PDF Generated')
            });
        });
</script>
<script type="text/javascript">
    function submitForm(discipline) {
        document.getElementById('selectedDiscipline').value = discipline;
        document.getElementById('filterForm').submit();
    }
</script>

<script>
    $('#show-more').on('click', function() {
        $('#dots').attr('hidden', true);
        $('#more').attr('hidden', false);
    });
</script>
<script>
    $('#show-less').on('click', function() {
        $('#dots').attr('hidden', false);
        $('#more').attr('hidden', true);
    });
</script>

{% endblock %}
