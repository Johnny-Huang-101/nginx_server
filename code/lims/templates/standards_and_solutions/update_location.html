{% extends "base.html" %}
{% block content %}
<style>
{% block style %}
{% endblock %}
</style>
{% block head %}
<head>
    {% if function in ['Edit', 'Approve', 'Update'] %}
        <title>{{config['SYSTEM_NAME']}}/{{item_name}}/{{item_dict['id']}}/{{function}}</title>
    {% else %}
        <title>{{config['SYSTEM_NAME']}}/{{item_name}}/{{function}}</title>
    {% endif %}
</head>
{% endblock %}
{% if item_dict and item_dict['communications'] and function == 'Approve' %}
    <div class="alert alert-warning" role="alert" style="margin-top:6px; background-color:rgb(221, 204, 238); color: black; border-color: #8b53e6">
        {% if item_dict['modified_by'] %}
            {% set date = item_dict['modify_date'].strftime('%m/%d/%Y %H:%M') %}
            {% set submitter = item_dict['modified_by'] %}
        {% else %}
            {% set date = item_dict['create_date'].strftime('%m/%d/%Y %H:%M') %}
            {% set submitter = item_dict['created_by'] %}
        {% endif %}
        <b>{{submitter}}</b> left the following communication
        on <b>{{date}}</b>:
        <ul>
            <li>{{item_dict['communications']}}</li>
        </ul>
    </div>
{% endif %}

{% if errors.unique_failed  %}
    <div class="alert alert-danger mt-3" role="alert" style="margin-top:6px">
        <p class="my-0">{{errors['unique_failed']}}</p>
    </div>
{% endif %}

<!-- ALERT BLOCK -->

{% block alerts %}
{% endblock %}

<!--#############-->
<div>
    <div style="margin-top:6px">
        {% if current_user.permissions not in ['INV', 'MED', 'MED-Autopsy', 'ADM'] %}
            <a href="{{url_for('dashboard.get_dashboard')}}"><i class="fa-solid fa-house"></i></a>
        {% else %}
            <a href="{{url_for('cases.view_list')}}"><i class="fa-solid fa-house"></i></a>
        {% endif %}
        > <a href="#">{{item_name}}</a>
        {% if function not in ['Edit', 'Approve', 'Update', 'Attach'] %}
            > {{function}}
        {% else %}
            > {{alias}}
            > {{function}}
        {% endif %}
     </div>
    <hr style="border-width:5px; margin-top: 6px">
    <h1>
        {% if default_header %}
            {% if function in ['Edit', 'Approve', 'Update'] %}
              {{function}} <a class="link-unstyled">{{alias}}</a>
            {% elif function == 'Attach' %}
              {{function}} Files To <a class="link-unstyled">{{alias}}</a>
            {% elif function == 'Import' %}
                {{function}} <a class="link-unstyled">{{item_name}}</a>
            {% elif function == 'Add' %}
              Add <a class="link-unstyled">{{item_type}}</a>
            {% else %}
                {{function}}
            {% endif %}
        {% endif %}

        {% block header %}
        {% endblock %}
    </h1>
    <hr style="border-width:5px; margin-top: 6px">
    <form method="POST" id="form" novalidate="novalidate" enctype="multipart/form-data" autocomplete="off">
        {{ form.hidden_tag() }}
    
        <!--FORM BLOCK-->
        {% block form %}
            <div class="row">
                {{form.location_table.label}}
                {{form.location_table(class='form-control selectpicker')}}
            </div>
            <div class="row">
                {{form.location_id.label}}
                {{form.location_id(class='form-control selectpicker')}}
            </div>
            <div class="row" style="display: flex; align-items: center; gap: 0.5em; margin-top: 1em;">
                {{form.no_location.label(style='margin: 0')}}
                {{form.no_location}}
            </div>

        {% endblock %}
        <!--###########-->
    
        <hr>
    
        <div class="form-group d-flex gap-2 align-items-center">
            {% if 'submit' in form and (module_name not in ['containers', 'specimens'] or function != 'Add') %}
                {{ form.submit(class='btn btn-primary mr-2') }}
            {% endif %}
    
            {% block buttons %}{% endblock %}
    
            {% if exit_route %}
                <a type="button" class="btn btn-secondary mr-2" href="{{exit_route}}" id="exit">Exit</a>
            {% else %}
                <a type="button" class="btn btn-secondary mr-2" href="{{url_for(table_name~'.view_list')}}">Exit</a>
            {% endif %}
        </div>
    </form>
    
        
    {% block text %}
    {% endblock %}
</div>


<!--MODAL BLOCK-->

{% block modals %}
{% endblock %}

<!--###########-->

<!-- SCRIPT BLOCK -->

{% block scripts %}
<script src="/static/form.js"></script>
<script src="/static/js/locations.js"></script>
<script>
    $(document).ready(function() {
        // get jQuery objects for all 3 fields
        const $table     = $("#location_table");
        const $id        = $("#location_id");
        const $noLoc     = $("#no_location");

        // toggle function
        function toggleLocationFields() {
            if ($noLoc.is(":checked")) {
                $table.prop("disabled", true);
                $id.prop("disabled", true);
                $table.selectpicker('refresh');
                $table.selectpicker('render');
                $id.prop("disabled", true);
                $id.selectpicker('refresh');
                $id.selectpicker('render');
            } else {
                $table.prop("disabled", false);
                $table.selectpicker('refresh');
                $table.selectpicker('render');
                $id.prop("disabled", false);
                $id.selectpicker('refresh');
                $id.selectpicker('render');
            }
        }

        // run once on page load (in case it's already checked)
        toggleLocationFields();

        // and every time the checkbox changes
        $noLoc.on("change", toggleLocationFields);
    });
</script>

{% endblock %}

<!--##############-->

<!--<script type="text/javascript">-->
<!--    let item_id = '{{item_id | safe}}'-->
<!--</script>-->


{% endblock %}