{% extends "list_template.html" %}

{% block icon %}
{% endblock %}

<!-- Custom Buttons -->
{% block buttons %}
<div class="dropdown" style="display: inline-block;">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="batches-filter" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Filter
    </button>
    <div class="dropdown-menu" aria-labelledby="batches-filter">
        <div class="dropdown-submenu dropright">
            <a class="dropdown-item dropdown-toggle" href="#">Type</a>
            <ul class="dropdown-menu">
                {% for option in kwargs['types'] %}
                    <li><a class="dropdown-item" href="{{url_for(table_name~'.view_list', query_type='type', query=type)}}">{{option}}</a></li>
                {% endfor %}
            </ul>
        </div>
         <div class="dropdown-submenu dropright">
            <a class="dropdown-item dropdown-toggle" href="#">Status</a>
            <ul class="dropdown-menu">
                 {% for option in kwargs['statuses'] %}
                <li><a class="dropdown-item" href="{{url_for(table_name~'.view_list', query_type='status', query=status)}}">{{option}}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

<!-- Header -->
{% block header %}
    <th>Equipment ID</th>
    <th>Status</th>
    <th>Next Service</th>
    <th>Location</th>
    <th>Type</th>
    <th>Manufacturer</th>
    <th>Last Service</th>
    <th>Provider</th>
    <th>Date Acquired</th>
    <th>Notes</th>
    <th>Module 1 Model No.</th>
    <th>Module 1 Serial No.</th>
    <th>Module 2 Model No.</th>
    <th>Module 2 Serial No.</th>
    <th>Module 3 Model No.</th>
    <th>Module 3 Serial No.</th>
    <th>Module 4 Model No.</th>
    <th>Module 4 Serial No.</th>
    <th>Module 5 Model No.</th>
    <th>Module 5 Serial No.</th>
    <th>Module 6 Model No.</th>
    <th>Module 6 Serial No.</th>
    <th>Module 7 Model No.</th>
    <th>Module 7 Serial No.</th>
    <th>Module 8 Model No.</th>
    <th>Module 8 Serial No.</th>
    <th>Module 9 Model No.</th>
    <th>Module 9 Serial No.</th>
    <th>PC OS</th>
    <th>PC Model</th>
    <th>Software</th>
    <th>Software Version</th>
    <th>Host Name</th>
    <th>IP Address</th>
{% endblock %}

<!-- Body -->
{% block body scoped %}
    <td>
        <a href="{{url_for(table_name~'.view', item_id=item.id)}}">
            {{item.instrument_id}}
        </a>
    </td>
    <td class="item-status">{{item.status.name}}</td>
    {% if item.due_service_date %}
        {% if item.status_id != 4 and item.due_service_date <= today %}
            <td style="background-color: #f8d7da">
        {% elif item.status_id != 4 and today < item.due_service_date <= within30d %}
            <td style="background-color: #fdf59a">
        {% else %}
            <td>
        {% endif %}
            {{item.due_service_date.strftime('%m/%d/%Y')}}</td>
        {% else %}
            <td></td>
    {% endif %}
    <td>
        {% for x in kwargs['locations'] %}
            {% if x.item_table == table_name %}
                {% if x.item_id == item.id %}
                    {% for cls in kwargs['models'] %}
                        {% if x.location_table is none %}
                        {% else %}
                            {% if cls == kwargs['location_dict'][x.location_table]['table'] %}
                                {% set alias = kwargs['location_dict'][x.location_table]['alias'] %}
                                {% if alias is string %}
                                    {{ cls.query.get(x.location_id) | getattr(alias) }}
                                {% elif alias is iterable %}
                                    {% for field in alias %}
                                        {{ cls.query.get(x.location_id) | getattr(field) }}{% if not loop.last %} - {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endif %}
        {% endfor %}
    </td>
    <td>{{item.type.name}}</td>
    <td>
        {% if item.agency.abbreviation %}
            {{item.agency.abbreviation}}
        {% else %}
            {{item.agency.name}}
        {% endif %}
    </td>
    <td>
        {% if item.last_service_date %}
            {{item.last_service_date.strftime('%m/%d/%Y')}}
        {% endif %}
    </td>
    <td>
        {% if item.vendor %}
            {% if item.vendor.name != "Service" %}
                {% if item.vendor.abbreviation %}
                    {{item.vendor.abbreviation}}
                {% else %}
                    {{item.vendor.name}}
                {% endif %}
            {% else %}
                {% if item.agency.abbreviation %}
                    {{item.vendor.name}} [{{item.vendor.agency.abbreviation}}]
                {% else %}
                    {{item.vendor.name}} [{{item.vendor.agency.name}}]
                {% endif %}
            {% endif %}
        {% endif %}
    </td>
    <td>
        {% if item.acquired_date %}
            {{item.acquired_date.strftime('%m/%d/%Y')}}
        {% endif %}
    </td>
    <td>{{item.notes}}</td>
    <td>{{item.module_model_1}}</td>
    <td>{{item.module_serial_1}}</td>
    <td>{{item.module_model_2}}</td>
    <td>{{item.module_serial_2}}</td>
    <td>{{item.module_model_3}}</td>
    <td>{{item.module_serial_3}}</td>
    <td>{{item.module_model_4}}</td>
    <td>{{item.module_serial_4}}</td>
    <td>{{item.module_model_5}}</td>
    <td>{{item.module_serial_5}}</td>
    <td>{{item.module_model_6}}</td>
    <td>{{item.module_serial_6}}</td>
    <td>{{item.module_model_7}}</td>
    <td>{{item.module_serial_7}}</td>
    <td>{{item.module_model_8}}</td>
    <td>{{item.module_serial_8}}</td>
    <td>{{item.module_model_9}}</td>
    <td>{{item.module_serial_9}}</td>
    <td>{{item.pc_os}}</td>
    <td>{{item.pc_model}}</td>
    <td>{{item.software}}</td>
    <td>{{item.software_version}}</td>
    <td>{{item.hostname}}</td>
    <td>{{item.ip_address}}</td>
{% endblock %}

<!--Modals-->
{% block modals %}
{% endblock %}

<!--Scripts-->
{% block scripts %}
<script src="/static/js/hide_lock.js"></script>
<script>
$(document).ready(function() {
    $.each($('.datatable tbody tr'), function () {
        // Highlight rows based on assay status
        // Inactive = Grey (secondary)
        // Out of Service = Yellow (warning)
        // Obsolete = Red (danger)
        var status = $(this).find('td.status').text();
        console.log(status);
        if (status == 'Inactive') {
            $(this).addClass('table-secondary')
        } else if (status == 'Out of Service') {
            $(this).addClass('table-warning')
        } else if (status == 'Obsolete') {
            $(this).addClass('table-danger')
        }
    });
});
</script>
<script src="/static/js/row_color_by_status.js"></script>
{% endblock %}
