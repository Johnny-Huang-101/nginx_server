{% extends "form_template.html" %}
{% block form %}
<div class="row form-group mb-4">
    <div class="col">
        {{ form.route.label }}
        {{ form.route(class_="selectpicker", id="route", data_live_search="true") }}
    </div>
    <div class="col">
        {{ form.attachment_type.label }}
        {{ form.attachment_type(class_="selectpicker", id="attachment_type", data_live_search="true") }}
    </div>
</div>
{% endblock %}

{% block modals %}
{% endblock %}

{% block scripts %}
<script>
    $(function() {
        $('#route').on('change', function() {
            console.log('Route changed');
            var selectedRoute = $('#route').val();
            console.log('Selected route:', selectedRoute);
            if (selectedRoute != 0) {
                $.getJSON('/get_attachment_types/', { route: selectedRoute }, function(data) {
                    console.log('Received data:', data);
                    var options = '<option value="">Please select a type</option>';
                    for (var item of data) {
                        options += '<option value="' + item.name + '">' + item.name + '</option>';
                    }
                    $('#attachment_type').html(options);
                    $('#attachment_type').selectpicker('refresh');
                });
            } else {
                $('#attachment_type').html('<option value="">Please select a type</option>');
                $('#attachment_type').selectpicker('refresh');
            }
        });

        $(window).on('load', function() {
            var selectedRoute = $('#route').val();
            if (selectedRoute != 0) {
                $.getJSON('/get_attachment_types/', { route: selectedRoute }, function(data) {
                    var options = '<option value="">Please select a type</option>';
                    for (var item of data) {
                        options += '<option value="' + item.name + '">' + item.name + '</option>';
                    }
                    $('#attachment_type').html(options);
                    $('#attachment_type').selectpicker('refresh');
                });
            } else {
                $('#attachment_type').html('<option value="">Please select a type</option>');
                $('#attachment_type').selectpicker('refresh');
            }
        });
    });
</script>
{% endblock %}
