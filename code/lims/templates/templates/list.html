{% extends "base.html" %}
{% block content %}
    <head>
        <title>{{item_name}}</title>
    </head>

<div>
    <div style="margin-top:6px">
    <a href="{{url_for('dashboard.get_dashboard')}}"><i class="fa-solid fa-house"></i></a>
    > {{item_name}}
     </div>
    <hr style="border-width:5px; margin-top:6px">
    <h1>{{item_name}}</h1>
    <hr style="border-width:5px">
    {% if n_pending != 0 or n_locked !=0 %}
      <div class="alert alert-warning" role="alert">
          There are currently:
          <ul class="alert-list">
            {% if n_pending %}
            <li>
                <a href="{{url_for(table_name~'.view_list', query='pending') }}"><strong>{{n_pending}} items</strong></a> requiring review.
            </li>
            {% endif %}
            {% if n_locked %}
            <li>
                <a href="{{url_for(table_name~'.view_list', query='locked') }}"><strong>{{n_locked}} items</strong></a> that are locked.
            </li>
            {% endif %}
          </ul>
      </div>
    {% endif %}

 <div class="d-flex justify-content-center" id="spinner-div">
    <div class="spinner-border" role="status" style="width: 3rem; height: 3rem;">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<div class="table display" id="table-div" style="opacity:0">
        <div class="table-responsive">
            <table class="display table-striped table-hover nowrap small datatable" style="width:100%;" id="{{table_name}}">
              <thead>
                <tr>
                  <th>Delete?</th>
                  <th>Pending Submitter</th>
                  <th>Status</th>
                  <th>Locked</th>
                  <th>Date Created</th>
                  <th>Created By</th>
                  <th>Date Modified</th>
                  <th>Modified By</th>
                </tr>
              </thead>
              <tbody id="body">
              {% for item in items %}
                   {% if item.db_status in ['Pending', 'Active with pending changes', 'Changes Pending'] %}
                    <tr class="table-warning">
                  {% elif item.db_status == 'Deletion Pending' %}
                    <tr class="table-danger">
                  {% elif item.db_status == 'Removed' %}
                    <tr class="table-secondary">
                  {% else %}
                    <tr class="table-default ">
                  {% endif %}
                  <td align="center"><a href="{{url_for(table_name~'.delete', item_id=item.id)}}" class="btn btn-danger btn-size"><i class="fa fa-trash-o btn-icon"></i></a></td>
                  <td align="center">
                      {% if item.pending_submitter %}
                        <a href="{{url_for(table_name~'.view', item_id=item.id, view_only=True)}}" class="btn btn-info btn-size"><i class="fa-solid fa-eye btn-icon"></i></a>
                      {% endif %}
                  </td>

                  <td scope="row">
                      {{item.db_status}}
                  </td>
                  <td>
                      {% if item.locked %}
                         <i class="fa-solid fa-lock"></i> {{item.locked_by}}
                      {% endif %}
                  </td>
                  <td>
                      {% if item.create_date %}
                        {{item.create_date.strftime('%m/%d/%Y')}}
                      {% endif %}
                  </td>
                  <td>{{item.created_by}}</td>
                  <td>
                      {% if item.modify_date %}
                        {{item.modify_date.strftime('%m/%d/%Y')}}
                      {% endif %}
                  </td>
                  {% if item.modified_by == None %}
                    <td></td>
                  {% else %}
                    <td>{{item.modified_by}}</td>
                  {% endif %}
              </tr>

              {% endfor %}

               </tbody>
             </table>

                <div>
                    Showing <span id="first">{{items.first}}</span> to
                    <span id="last">{{items.last}}</span> of
                    <span id="total">{{items.total}}</span> entries
                    <span id="filtered" hidden>(filtered from {{items.last}} entries)</span>
                </div>
                <hr>
                <div class="row" style="width: 100%">
                    <div class="col">
                        <form action="{{ url_for(table_name~'.view_list')}}" method="POST">
                            Show
                            <div class="form-group px-0" style="display:inline-block">
                                <select class="form-control" name="length" id="length" onchange="this.form.submit()">
                                    <option value="10">10</option>
                                    <option value=100>100</option>
                                    <option value="1000">1000</option>
                                    <option value="-1">All</option>
                                </select>
                            </div>
                            entries per page
                        </form>
                    </div>
                    <div class="col" style="display: flex; justify-content: flex-end">
                        <nav aria-label="Page navigation example">
                             <ul class="pagination">
                                 {% if items.page == 1 %}
                                 <li class="page-item disabled">
                                 {% else %}
                                 <li class="page-item">
                                  {% endif %}
                                    <a class="page-link" href="{{ url_for(table_name~'.view_list', page=items.page-1, length=length) }}" tabindex="-1">Previous</a>
                                </li>

                                 {% for page_num in items.iter_pages(left_edge=1, right_edge=2, left_current=1, right_current=2) %}
                                 {% if page_num %}
                                     {% if items.page == page_num %}
                                        <li class="page-item active">
                                            <a class="page-link">{{ page_num }}</a></li>
                                     {% else %}
                                        <li class="page-item"><a class="page-link" href="{{ url_for(table_name~'.view_list', page=page_num, length=length) }}">{{ page_num }}</a></li>
                                     {% endif %}
                                 {% else %}
                                      <li class="page-item disabled"><a class="page-link">â€¦</a></li>
                                 {% endif %}
                              {% endfor %}

                                {% if items.page == items.pages %}
                                <li class="page-item disabled">
                                {% else %}
                                 <li class="page-item">
                                  {% endif %}
                                    <a class="page-link" href="{{ url_for(table_name~'.view_list', page=items.page+1, length=length) }}" tabindex="-1">Next</a>
                                </li>
                             </ul>
                        </nav>
                    <div class="pl-2">
                        <div class="form-inline">
                              <input class="form-control mr-2" style="width: 10rem" id="page-num" placeholder="Go to page...">
                              <a class="btn btn-primary" id="go-to-page">Go</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    let table_name = '{{table_name | safe}}'
</script>

<script>

    $(document).ready(function () {
    // Setup - add a text input to each footer cell

     $("#length").val({{length}});

     var buttons = []

     buttons.push({
            className: 'btn btn-primary mb-3',
            text: 'Add {{item_type}}',
            action: function (e, dt, node, config) {
            window.location.href = "{{url_for(table_name~'.add')}}";
            }
            })

      buttons.push({
        className: 'btn btn-primary mb-3',
        text: 'Import {{item_name}}',
        action: function (e, dt, node, config) {
        window.location.href = "{{url_for(table_name~'.import_file')}}";
        }
        })

     buttons.push({
            extend: 'csvHtml5',
            className: 'btn btn-secondary mb-3',
            text: '<i class="fa-solid fa-file-export"></i> Export View',
            autoFilter: true,
            title: '{{item_name}}_'+moment().format('YYYYMMDDHHmmss'),
            sheetName: 'export'
            })

     buttons.push({
            className: 'btn btn-secondary mb-3',
            text: '<i class="fa-solid fa-file-export"></i> Export {{item_name}}',
            action: function (e, dt, node, config) {
            window.location.href = "{{url_for(table_name~'.export')}}";
            }
            })


     initDataTable($('#{{table_name}}'), buttons, {{kwargs['length']}})

});
</script>

{% endblock %}